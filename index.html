<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <title>Pint of No Return — How the Government is Killing Your Local</title>
    <meta name="description" content="33p of every £1 you spend on a pint goes to the Treasury. They just hiked taxes again. 15,800 pubs lost since 2000. Explore the data.">
    <meta property="og:title" content="Pint of No Return — How the Government is Killing Your Local">
    <meta property="og:description" content="33p of every £1 goes to the Treasury. They just hiked NI, slashed rates relief, and wonder why pubs are closing. The data doesn't lie.">
    <meta property="og:type" content="website">
    <meta name="theme-color" content="#0d1117">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Cdefs%3E%3ClinearGradient id='b' x1='0' y1='0' x2='0' y2='1'%3E%3Cstop offset='0%25' stop-color='%23f0c040'/%3E%3Cstop offset='100%25' stop-color='%23d4900a'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect x='14' y='12' width='36' height='44' rx='3' fill='%23222' stroke='%23555' stroke-width='2'/%3E%3Crect x='18' y='20' width='28' height='32' rx='2' fill='url(%23b)'/%3E%3Crect x='18' y='20' width='28' height='8' rx='2' fill='white' opacity='0.3'/%3E%3Crect x='8' y='22' width='6' height='20' rx='3' fill='%23333' stroke='%23555' stroke-width='1.5'/%3E%3Ctext x='32' y='46' text-anchor='middle' font-family='sans-serif' font-weight='bold' font-size='11' fill='%23222'%3EPONR%3C/text%3E%3C/svg%3E">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
    <style>
        /* ==========================================
           RESET & BASE
        ========================================== */
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-card: #1a1a26;
            --bg-card-hover: #22222f;
            --bg-elevated: #242433;
            --border: #2a2a3a;
            --border-light: #1e1e2e;

            --text-primary: #e8e8f0;
            --text-secondary: #8888a0;
            --text-tertiary: #55556a;

            --green: #00d4a1;
            --green-dim: rgba(0, 212, 161, 0.12);
            --green-glow: rgba(0, 212, 161, 0.3);
            --red: #ff4757;
            --red-dim: rgba(255, 71, 87, 0.12);
            --amber: #f0a030;
            --amber-dim: rgba(240, 160, 48, 0.12);
            --blue: #4a90ff;
            --blue-dim: rgba(74, 144, 255, 0.12);
            --teal: #2dd4bf;
            --teal-dim: rgba(45, 212, 191, 0.12);

            --font-mono: 'JetBrains Mono', 'SF Mono', monospace;
            --font-sans: 'Inter', -apple-system, sans-serif;

            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;

            --safe-top: env(safe-area-inset-top, 0px);
            --safe-bottom: env(safe-area-inset-bottom, 0px);
        }

        html {
            background: var(--bg-primary);
            color: var(--text-primary);
            font-family: var(--font-sans);
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }

        body {
            background: var(--bg-primary);
            min-height: 100vh;
            min-height: 100dvh;
            padding-bottom: calc(72px + var(--safe-bottom));
        }

        /* ==========================================
           LOADING SCREEN
        ========================================== */
        .loader {
            position: fixed;
            inset: 0;
            background: var(--bg-primary);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s, visibility 0.5s;
        }

        .loader.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .loader-logo {
            font-family: var(--font-mono);
            font-size: 28px;
            font-weight: 700;
            color: var(--green);
            letter-spacing: -1px;
            margin-bottom: 24px;
        }

        .loader-logo span { color: var(--text-tertiary); }

        .loader-bar {
            width: 200px;
            height: 2px;
            background: var(--border);
            border-radius: 2px;
            overflow: hidden;
        }

        .loader-bar-fill {
            height: 100%;
            background: var(--green);
            border-radius: 2px;
            animation: loadBar 1.8s ease-in-out forwards;
            box-shadow: 0 0 12px var(--green-glow);
        }

        @keyframes loadBar {
            0% { width: 0%; }
            30% { width: 40%; }
            60% { width: 70%; }
            100% { width: 100%; }
        }

        .loader-text {
            font-family: var(--font-mono);
            font-size: 11px;
            color: var(--text-tertiary);
            margin-top: 16px;
            letter-spacing: 1px;
        }

        /* ==========================================
           STATUS BAR (FAKE iOS)
        ========================================== */
        .status-bar {
            padding: calc(var(--safe-top) + 8px) 20px 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: var(--font-sans);
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .status-bar-time { font-variant-numeric: tabular-nums; }

        .status-bar-icons {
            display: flex;
            gap: 6px;
            align-items: center;
        }

        .status-bar-icons svg { width: 16px; height: 16px; fill: var(--text-secondary); }

        /* ==========================================
           APP HEADER
        ========================================== */
        .app-header {
            padding: 12px 20px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .app-logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .app-logo-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            overflow: hidden;
        }

        .app-logo-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .app-logo-text {
            font-family: var(--font-mono);
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: -0.5px;
        }

        .app-logo-text span {
            color: var(--text-tertiary);
            font-weight: 400;
        }

        .header-actions {
            display: flex;
            gap: 8px;
        }

        .header-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--bg-card);
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
        }

        .header-btn svg { width: 18px; height: 18px; stroke: var(--text-secondary); fill: none; stroke-width: 1.8; }

        .notification-dot {
            position: absolute;
            top: 6px;
            right: 6px;
            width: 7px;
            height: 7px;
            background: var(--red);
            border-radius: 50%;
            border: 1.5px solid var(--bg-primary);
        }

        /* ==========================================
           LIVE TICKER
        ========================================== */
        .ticker-wrap {
            border-top: 1px solid var(--border-light);
            border-bottom: 1px solid var(--border-light);
            overflow: hidden;
            background: var(--bg-secondary);
            padding: 10px 0;
        }

        .ticker {
            display: flex;
            gap: 32px;
            animation: tickerScroll 30s linear infinite;
            width: max-content;
        }

        @keyframes tickerScroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        .ticker-item {
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
            font-family: var(--font-mono);
            font-size: 12px;
        }

        .ticker-name {
            color: var(--text-secondary);
            font-weight: 500;
        }

        .ticker-price {
            color: var(--text-primary);
            font-weight: 600;
        }

        .ticker-change {
            font-weight: 600;
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 4px;
        }

        .ticker-change.up {
            color: var(--red);
            background: var(--red-dim);
        }

        .ticker-change.down {
            color: var(--green);
            background: var(--green-dim);
        }

        /* ==========================================
           PORTFOLIO SUMMARY
        ========================================== */
        .portfolio {
            padding: 24px 20px;
        }

        .portfolio-label {
            font-size: 13px;
            color: var(--text-tertiary);
            font-weight: 500;
            margin-bottom: 4px;
        }

        .portfolio-value {
            font-family: var(--font-mono);
            font-size: 42px;
            font-weight: 700;
            letter-spacing: -2px;
            color: var(--text-primary);
            line-height: 1;
        }

        .portfolio-value .currency {
            font-size: 28px;
            color: var(--text-tertiary);
            font-weight: 400;
        }

        .portfolio-change {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            margin-top: 10px;
            font-family: var(--font-mono);
            font-size: 14px;
            font-weight: 600;
        }

        .portfolio-change.positive { color: var(--red); }
        .portfolio-change.negative { color: var(--green); }

        .portfolio-change .label {
            color: var(--text-tertiary);
            font-weight: 400;
            font-size: 12px;
            font-family: var(--font-sans);
        }

        .portfolio-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 24px;
        }

        .portfolio-stat {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            padding: 14px;
        }

        .portfolio-stat-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-tertiary);
            margin-bottom: 6px;
            font-weight: 600;
        }

        .portfolio-stat-value {
            font-family: var(--font-mono);
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .portfolio-stat-value.green { color: var(--green); }
        .portfolio-stat-value.red { color: var(--red); }
        .portfolio-stat-value.amber { color: var(--amber); }

        /* ==========================================
           CHART SECTION
        ========================================== */
        .chart-section {
            padding: 0 20px 24px;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 4px;
        }

        .chart-pub-name {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .chart-pub-type {
            font-size: 11px;
            color: var(--text-tertiary);
            margin-top: 2px;
        }

        .chart-current {
            text-align: right;
        }

        .chart-current-price {
            font-family: var(--font-mono);
            font-size: 22px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .chart-current-change {
            font-family: var(--font-mono);
            font-size: 12px;
            font-weight: 600;
            color: var(--red);
        }

        .chart-canvas {
            width: 100%;
            height: 200px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
            border-radius: var(--radius-md);
        }

        .chart-canvas svg {
            width: 100%;
            height: 100%;
        }

        .chart-time-toggles {
            display: flex;
            gap: 4px;
            background: var(--bg-card);
            border-radius: var(--radius-sm);
            padding: 3px;
        }

        .chart-time-btn {
            flex: 1;
            padding: 8px 0;
            font-family: var(--font-mono);
            font-size: 12px;
            font-weight: 600;
            color: var(--text-tertiary);
            background: none;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .chart-time-btn.active {
            background: var(--bg-elevated);
            color: var(--text-primary);
        }

        /* ==========================================
           SECTION HEADERS
        ========================================== */
        .section-header {
            padding: 24px 20px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-title {
            font-size: 17px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .section-link {
            font-size: 13px;
            font-weight: 600;
            color: var(--green);
            cursor: pointer;
        }

        /* ==========================================
           MARKET MOVERS
        ========================================== */
        .movers {
            padding: 0 20px;
            display: flex;
            gap: 12px;
            overflow-x: auto;
            scrollbar-width: none;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 4px;
        }

        .movers::-webkit-scrollbar { display: none; }

        .mover-card {
            min-width: 160px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            padding: 16px;
            flex-shrink: 0;
        }

        .mover-card.drop { border-left: 3px solid var(--green); }
        .mover-card.rise { border-left: 3px solid var(--red); }

        .mover-pub {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .mover-type {
            font-size: 10px;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .mover-price {
            font-family: var(--font-mono);
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .mover-change {
            font-family: var(--font-mono);
            font-size: 13px;
            font-weight: 600;
        }

        .mover-change.down { color: var(--green); }
        .mover-change.up { color: var(--red); }

        .mover-sparkline {
            margin-top: 12px;
            height: 32px;
        }

        .mover-sparkline svg {
            width: 100%;
            height: 100%;
        }

        /* ==========================================
           WATCHLIST
        ========================================== */
        .watchlist {
            padding: 0 20px;
        }

        .watchlist-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 0;
            border-bottom: 1px solid var(--border-light);
        }

        .watchlist-item:last-child { border-bottom: none; }

        .watchlist-left {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
            min-width: 0;
        }

        .watchlist-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .watchlist-info { min-width: 0; }

        .watchlist-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .watchlist-meta {
            font-size: 12px;
            color: var(--text-tertiary);
            margin-top: 2px;
        }

        .watchlist-center {
            width: 64px;
            height: 32px;
            flex-shrink: 0;
            margin: 0 12px;
        }

        .watchlist-center svg {
            width: 100%;
            height: 100%;
        }

        .watchlist-right {
            text-align: right;
            flex-shrink: 0;
        }

        .watchlist-price {
            font-family: var(--font-mono);
            font-size: 15px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .watchlist-change {
            font-family: var(--font-mono);
            font-size: 12px;
            font-weight: 600;
            margin-top: 2px;
            padding: 2px 8px;
            border-radius: 4px;
            display: inline-block;
        }

        .watchlist-change.up {
            color: var(--red);
            background: var(--red-dim);
        }

        .watchlist-change.down {
            color: var(--green);
            background: var(--green-dim);
        }

        .watchlist-change.flat {
            color: var(--text-tertiary);
            background: var(--bg-elevated);
        }

        /* ==========================================
           PRICE ALERTS
        ========================================== */
        .alerts {
            padding: 0 20px;
        }

        .alert-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            padding: 16px;
            margin-bottom: 10px;
            display: flex;
            gap: 14px;
            align-items: flex-start;
        }

        .alert-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }

        .alert-icon.drop {
            background: var(--green-dim);
        }

        .alert-icon.rise {
            background: var(--red-dim);
        }

        .alert-icon.info {
            background: var(--blue-dim);
        }

        .alert-content { flex: 1; }

        .alert-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .alert-desc {
            font-size: 12px;
            color: var(--text-tertiary);
            line-height: 1.5;
        }

        .alert-time {
            font-family: var(--font-mono);
            font-size: 11px;
            color: var(--text-tertiary);
            flex-shrink: 0;
        }

        /* ==========================================
           REGIONAL INDEX
        ========================================== */
        .regional {
            padding: 0 20px 24px;
        }

        .regional-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 20px;
        }

        .regional-row {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 0;
        }

        .regional-row:not(:last-child) {
            border-bottom: 1px solid var(--border-light);
        }

        .regional-rank {
            font-family: var(--font-mono);
            font-size: 12px;
            font-weight: 600;
            color: var(--text-tertiary);
            width: 20px;
            text-align: center;
        }

        .regional-name {
            flex: 1;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .regional-bar-wrap {
            width: 100px;
            height: 6px;
            background: var(--bg-elevated);
            border-radius: 3px;
            overflow: hidden;
        }

        .regional-bar {
            height: 100%;
            border-radius: 3px;
            transition: width 1s ease;
        }

        .regional-price {
            font-family: var(--font-mono);
            font-size: 14px;
            font-weight: 700;
            color: var(--text-primary);
            width: 50px;
            text-align: right;
        }

        /* ==========================================
           MARKET NEWS
        ========================================== */
        .news {
            padding: 0 20px 24px;
        }

        .news-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            padding: 16px;
            margin-bottom: 10px;
        }

        .news-eyebrow {
            font-family: var(--font-mono);
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--amber);
            margin-bottom: 8px;
        }

        .news-title {
            font-size: 15px;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.4;
            margin-bottom: 8px;
        }

        .news-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .news-source {
            font-size: 12px;
            color: var(--text-tertiary);
        }

        .news-time {
            font-family: var(--font-mono);
            font-size: 11px;
            color: var(--text-tertiary);
        }

        /* ==========================================
           BOTTOM TAB BAR
        ========================================== */
        .tab-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border);
            display: flex;
            padding: 8px 0 calc(8px + var(--safe-bottom));
            z-index: 100;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            background: rgba(18, 18, 26, 0.92);
        }

        .tab-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            padding: 4px 0;
        }

        .tab-item svg {
            width: 22px;
            height: 22px;
            stroke: var(--text-tertiary);
            fill: none;
            stroke-width: 1.8;
            transition: all 0.2s;
        }

        .tab-item span {
            font-size: 10px;
            font-weight: 600;
            color: var(--text-tertiary);
            transition: all 0.2s;
        }

        .tab-item.active svg { stroke: var(--green); }
        .tab-item.active span { color: var(--green); }

        /* ==========================================
           CONCEPT BADGE
        ========================================== */
        .concept-badge {
            position: fixed;
            bottom: calc(80px + var(--safe-bottom));
            left: 12px;
            background: rgba(240, 160, 48, 0.15);
            border: 1px solid rgba(240, 160, 48, 0.3);
            color: var(--amber);
            font-size: 10px;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 20px;
            z-index: 200;
            font-family: var(--font-sans);
            letter-spacing: 0.3px;
        }

        /* ==========================================
           NARRATIVE — THE REAL COST
        ========================================== */
        .narrative-cost {
            padding: 0 20px 24px;
        }

        .narrative-cost-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 20px;
        }

        .narrative-cost-intro {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .narrative-cost-intro strong {
            color: var(--text-primary);
            font-weight: 600;
        }

        .narrative-bar-track {
            width: 100%;
            height: 40px;
            border-radius: var(--radius-sm);
            overflow: hidden;
            display: flex;
            margin-bottom: 8px;
        }

        .narrative-bar-segment {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: var(--font-mono);
            font-size: 11px;
            font-weight: 600;
            color: var(--bg-primary);
            transition: width 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            overflow: hidden;
        }

        .narrative-bar-segment.narrative-seg-duty { background: var(--red); }
        .narrative-bar-segment.narrative-seg-brewery { background: var(--amber); }
        .narrative-bar-segment.narrative-seg-rent { background: var(--blue); }
        .narrative-bar-segment.narrative-seg-staff { background: var(--teal); }
        .narrative-bar-segment.narrative-seg-profit { background: var(--green); }

        .narrative-bar-labels {
            display: flex;
            gap: 0;
            margin-bottom: 20px;
        }

        .narrative-bar-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 6px 4px;
        }

        .narrative-bar-label-name {
            font-size: 10px;
            color: var(--text-tertiary);
            text-align: center;
            line-height: 1.3;
            font-weight: 500;
        }

        .narrative-bar-label-value {
            font-family: var(--font-mono);
            font-size: 12px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .narrative-bar-label-pct {
            font-family: var(--font-mono);
            font-size: 10px;
            font-weight: 600;
            color: var(--text-tertiary);
        }

        .narrative-cost-callout {
            background: var(--bg-elevated);
            border-left: 3px solid var(--amber);
            border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
            padding: 14px 16px;
            margin-top: 4px;
        }

        .narrative-cost-callout p {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            line-height: 1.5;
        }

        .narrative-cost-callout span {
            color: var(--amber);
        }

        /* ==========================================
           NARRATIVE — PUBS WE'RE LOSING
        ========================================== */
        .narrative-closures {
            padding: 0 20px 24px;
        }

        .narrative-closures-card {
            background: linear-gradient(180deg, rgba(255, 71, 87, 0.06) 0%, var(--bg-card) 40%);
            border: 1px solid rgba(255, 71, 87, 0.15);
            border-radius: var(--radius-lg);
            padding: 32px 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .narrative-closures-bg {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 200px;
            background: url('closed-pub-web.jpg') center top / cover no-repeat;
            opacity: 0.12;
            mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 0%, rgba(0,0,0,0) 100%);
            -webkit-mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 0%, rgba(0,0,0,0) 100%);
        }

        .narrative-closures-counter {
            font-family: var(--font-mono);
            font-size: 72px;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: -3px;
            line-height: 1;
            margin-bottom: 8px;
        }

        .narrative-closures-counter .narrative-plus {
            color: var(--red);
            font-size: 48px;
        }

        .narrative-closures-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .narrative-closures-rate {
            font-family: var(--font-mono);
            font-size: 15px;
            font-weight: 600;
            color: var(--red);
            margin-bottom: 28px;
        }

        .narrative-closures-stats {
            display: flex;
            justify-content: center;
            gap: 0;
            margin-bottom: 28px;
            flex-wrap: wrap;
        }

        .narrative-closures-stat {
            padding: 0 14px;
            border-right: 1px solid var(--border);
            text-align: center;
        }

        .narrative-closures-stat:last-child {
            border-right: none;
        }

        .narrative-closures-stat-value {
            font-family: var(--font-mono);
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .narrative-closures-stat-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: var(--text-tertiary);
            font-weight: 600;
        }

        .narrative-closures-quote {
            font-size: 14px;
            font-style: italic;
            color: var(--text-secondary);
            line-height: 1.6;
            max-width: 320px;
            margin: 0 auto;
            padding-top: 20px;
            border-top: 1px solid var(--border-light);
        }

        /* ==========================================
           NARRATIVE — INFLATION COMPARISON
        ========================================== */
        .narrative-inflation {
            padding: 0 20px 24px;
        }

        .narrative-inflation-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 20px;
        }

        .narrative-inflation-subtitle {
            font-size: 12px;
            color: var(--text-tertiary);
            margin-bottom: 20px;
            font-weight: 500;
        }

        .narrative-inflation-rows {
            display: flex;
            flex-direction: column;
            gap: 14px;
            margin-bottom: 24px;
        }

        .narrative-inflation-row {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .narrative-inflation-row-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
        }

        .narrative-inflation-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .narrative-inflation-value {
            font-family: var(--font-mono);
            font-size: 14px;
            font-weight: 700;
        }

        .narrative-inflation-value.narrative-highlight { color: var(--red); }
        .narrative-inflation-value.narrative-neutral { color: var(--text-primary); }

        .narrative-inflation-bar-track {
            width: 100%;
            height: 8px;
            background: var(--bg-elevated);
            border-radius: 4px;
            overflow: hidden;
        }

        .narrative-inflation-bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .narrative-inflation-bar-fill.narrative-bar-pint { background: var(--red); }
        .narrative-inflation-bar-fill.narrative-bar-cpi { background: var(--text-tertiary); }
        .narrative-inflation-bar-fill.narrative-bar-wage { background: var(--amber); }
        .narrative-inflation-bar-fill.narrative-bar-house { background: var(--blue); }

        .narrative-inflation-divider {
            height: 1px;
            background: var(--border-light);
            margin: 20px 0;
        }

        .narrative-inflation-insight {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }

        .narrative-inflation-insight-block {
            text-align: center;
            flex: 1;
        }

        .narrative-inflation-insight-year {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-tertiary);
            font-weight: 600;
            margin-bottom: 4px;
        }

        .narrative-inflation-insight-pints {
            font-family: var(--font-mono);
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1;
        }

        .narrative-inflation-insight-pints small {
            font-size: 13px;
            color: var(--text-tertiary);
            font-weight: 500;
        }

        .narrative-inflation-insight-arrow {
            font-size: 20px;
            color: var(--red);
            flex-shrink: 0;
        }

        .narrative-inflation-footnote {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.6;
            text-align: center;
        }

        .narrative-inflation-footnote strong {
            color: var(--text-primary);
            font-weight: 600;
        }

        .narrative-inflation-footnote .narrative-emphasis {
            color: var(--red);
            font-family: var(--font-mono);
            font-weight: 700;
        }

        /* ==========================================
           THE GAP — THREE PRICE CARDS
        ========================================== */
        .gap-section {
            padding: 0 20px 8px;
        }

        .gap-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .gap-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            padding: 16px 12px;
            text-align: center;
        }

        .gap-card-spoons {
            border-color: var(--amber);
            box-shadow: 0 0 20px rgba(240, 160, 48, 0.08);
        }

        .gap-card-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-tertiary);
            font-weight: 600;
            margin-bottom: 8px;
        }

        .gap-card-price {
            font-family: var(--font-mono);
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .gap-card-sub {
            font-size: 10px;
            color: var(--text-tertiary);
            margin-bottom: 12px;
        }

        .gap-card-bar {
            height: 4px;
            background: var(--bg-elevated);
            border-radius: 2px;
            overflow: hidden;
        }

        .gap-bar-fill {
            height: 100%;
            border-radius: 2px;
            transition: width 1s ease;
        }

        .gap-callout {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-left: 3px solid var(--red);
            border-radius: var(--radius-sm);
            padding: 16px;
            margin-top: 12px;
        }

        .gap-callout p {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .gap-callout span {
            color: var(--text-primary);
            font-weight: 700;
            font-family: var(--font-mono);
        }

        /* ==========================================
           SPOONS ADVANTAGE
        ========================================== */
        .spoons-advantage {
            padding: 0 20px 8px;
        }

        .spoons-advantage-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 20px;
        }

        .advantage-row {
            display: flex;
            gap: 14px;
            align-items: flex-start;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-light);
        }

        .advantage-row:last-of-type {
            border-bottom: none;
        }

        .advantage-icon {
            min-width: 44px;
            height: 44px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: var(--font-mono);
            font-size: 13px;
            font-weight: 700;
        }

        .advantage-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 3px;
        }

        .advantage-desc {
            font-size: 12px;
            color: var(--text-tertiary);
            line-height: 1.4;
        }

        .advantage-callout {
            background: var(--bg-elevated);
            border-radius: var(--radius-sm);
            padding: 16px;
            margin-top: 16px;
        }

        .advantage-callout p {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .advantage-callout span {
            color: var(--text-primary);
            font-weight: 700;
            font-family: var(--font-mono);
        }

        /* ==========================================
           DECLINE SPLIT (indie vs chain)
        ========================================== */
        .decline-split {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 20px 0 16px;
            padding: 16px;
            background: rgba(0,0,0,0.25);
            border-radius: var(--radius-md);
        }

        .decline-split-item {
            flex: 1;
            text-align: center;
        }

        .decline-split-value {
            font-family: var(--font-mono);
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .decline-split-label {
            font-size: 11px;
            color: var(--text-tertiary);
            line-height: 1.3;
        }

        .decline-split-divider {
            width: 1px;
            height: 48px;
            background: var(--border);
        }

        /* ==========================================
           STATEMENT ZONE — editorial break from terminal
        ========================================== */
        .statement-zone {
            position: relative;
            padding-top: 8px;
            margin-top: 12px;
        }

        .statement-zone::before {
            content: '';
            position: absolute;
            top: 0;
            left: 20px;
            right: 20px;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--red), var(--amber), var(--red), transparent);
        }

        .statement-divider {
            padding: 40px 20px 12px;
            text-align: center;
        }

        .statement-divider-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 3px;
            color: var(--red);
            font-weight: 600;
            font-family: var(--font-mono);
            margin-bottom: 16px;
        }

        .statement-divider-headline {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.2;
            max-width: 500px;
            margin: 0 auto 8px;
            letter-spacing: -0.5px;
        }

        .statement-divider-sub {
            font-size: 14px;
            color: var(--text-tertiary);
            max-width: 400px;
            margin: 0 auto;
            line-height: 1.5;
        }

        /* Override section headers inside statement zone */
        .statement-zone .section-header {
            padding: 36px 20px 16px;
        }

        .statement-zone .section-title {
            font-size: 22px;
            font-weight: 700;
            letter-spacing: -0.3px;
        }

        .statement-zone .section-link {
            font-size: 12px;
            letter-spacing: 0.5px;
        }

        /* Bigger narrative intros */
        .statement-zone .narrative-cost-intro {
            font-size: 16px;
            line-height: 1.7;
            color: var(--text-primary);
        }

        /* Bigger callouts */
        .statement-zone .narrative-cost-callout p,
        .statement-zone .advantage-callout p {
            font-size: 15px;
            line-height: 1.7;
        }

        .statement-zone .narrative-cost-callout span,
        .statement-zone .advantage-callout span {
            font-size: 16px;
        }

        /* Bigger cost bar labels */
        .statement-zone .narrative-bar-label-value {
            font-size: 13px;
        }

        /* Bigger decline counter */
        .statement-zone .narrative-closures-counter {
            font-size: 72px;
        }

        .statement-zone .narrative-closures-subtitle {
            font-size: 16px;
        }

        .statement-zone .narrative-closures-rate {
            font-size: 15px;
        }

        .statement-zone .narrative-closures-quote {
            font-size: 16px;
            line-height: 1.6;
            font-style: italic;
        }

        /* Bigger community stats */
        .statement-zone .community-stat-value {
            font-size: 26px;
        }

        .statement-zone .community-context-text {
            font-size: 13px;
            line-height: 1.6;
        }

        .statement-zone .community-quote {
            font-size: 16px;
            line-height: 1.7;
            padding: 20px;
        }

        /* Bolder news cards */
        .statement-zone .news-card {
            padding: 20px;
        }

        .statement-zone .news-title {
            font-size: 15px;
            line-height: 1.6;
            font-weight: 500;
        }

        .statement-zone .news-eyebrow {
            font-size: 10px;
            letter-spacing: 1.5px;
        }

        /* Government section gets even more dramatic in statement zone */
        .statement-zone .govt-cut-headline {
            font-size: 36px;
        }

        .statement-zone .govt-cut-subhead {
            font-size: 15px;
        }

        .statement-zone .govt-hit-value {
            font-size: 22px;
        }

        .statement-zone .govt-vat-value {
            font-size: 28px;
        }

        .statement-zone .govt-cut-callout p {
            font-size: 16px;
            line-height: 1.7;
        }

        /* ==========================================
           PINT CALCULATOR
        ========================================== */
        .pint-calc {
            padding: 0 20px 8px;
        }

        .pint-calc-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 24px 20px;
        }

        .pint-calc-prompt {
            font-size: 16px;
            color: var(--text-primary);
            margin-bottom: 16px;
            font-weight: 500;
        }

        .pint-calc-input-wrap {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
        }

        .pint-calc-input-wrap .currency-symbol {
            font-family: var(--font-mono);
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .pint-calc-input {
            font-family: var(--font-mono);
            font-size: 32px;
            font-weight: 700;
            background: var(--bg-elevated);
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            padding: 8px 16px;
            width: 140px;
            outline: none;
            transition: border-color 0.2s;
        }

        .pint-calc-input:focus {
            border-color: var(--amber);
        }

        .pint-calc-breakdown {
            display: flex;
            flex-direction: column;
            gap: 0;
        }

        .pint-calc-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px dashed var(--border-light);
        }

        .pint-calc-row:last-child {
            border-bottom: none;
        }

        .pint-calc-row-label {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .pint-calc-row-value {
            font-family: var(--font-mono);
            font-size: 15px;
            font-weight: 700;
        }

        .pint-calc-row.govt-row {
            background: rgba(255, 71, 87, 0.06);
            margin: 0 -12px;
            padding: 10px 12px;
            border-radius: var(--radius-sm);
        }

        .pint-calc-row.govt-row .pint-calc-row-label {
            color: var(--red);
            font-weight: 600;
        }

        .pint-calc-row.profit-row .pint-calc-row-value {
            color: var(--green);
        }

        .pint-calc-total {
            margin-top: 16px;
            padding: 16px;
            background: rgba(255, 71, 87, 0.08);
            border: 1px solid rgba(255, 71, 87, 0.2);
            border-radius: var(--radius-sm);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .pint-calc-total-label {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .pint-calc-total-label span {
            display: block;
            font-size: 11px;
            color: var(--text-tertiary);
            margin-top: 2px;
        }

        .pint-calc-total-ratio {
            font-family: var(--font-mono);
            font-size: 28px;
            font-weight: 700;
            color: var(--red);
        }

        .pint-calc-pints-needed {
            margin-top: 12px;
            text-align: center;
            font-size: 12px;
            color: var(--text-tertiary);
            line-height: 1.6;
        }

        .pint-calc-pints-needed strong {
            color: var(--amber);
            font-family: var(--font-mono);
            font-size: 14px;
        }

        /* ==========================================
           RECEIPT
        ========================================== */
        .receipt-section {
            padding: 0 20px 8px;
        }

        .receipt {
            background: #f5f0e8;
            color: #1a1a1a;
            font-family: 'Courier New', Courier, monospace;
            padding: 28px 24px;
            border-radius: 4px;
            max-width: 340px;
            margin: 0 auto;
            position: relative;
            box-shadow: 0 4px 24px rgba(0,0,0,0.3);
        }

        .receipt::before,
        .receipt::after {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            height: 8px;
            background: linear-gradient(135deg, transparent 33.33%, #f5f0e8 33.33%, #f5f0e8 66.67%, transparent 66.67%);
            background-size: 12px 100%;
        }

        .receipt::before { top: -8px; }
        .receipt::after { bottom: -8px; transform: rotate(180deg); }

        .receipt-header {
            text-align: center;
            padding-bottom: 12px;
            border-bottom: 2px dashed #999;
            margin-bottom: 12px;
        }

        .receipt-pub-name {
            font-size: 16px;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .receipt-pub-sub {
            font-size: 10px;
            color: #666;
            margin-top: 2px;
        }

        .receipt-line {
            display: flex;
            justify-content: space-between;
            padding: 3px 0;
            font-size: 12px;
        }

        .receipt-line.indent {
            padding-left: 16px;
            font-size: 11px;
            color: #555;
        }

        .receipt-line.govt-line {
            color: #c0392b;
            font-weight: 700;
        }

        .receipt-line.indent.govt-line {
            font-weight: 400;
        }

        .receipt-dashed {
            border-top: 1px dashed #999;
            margin: 8px 0;
        }

        .receipt-double {
            border-top: 2px solid #333;
            margin: 8px 0;
        }

        .receipt-total-line {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            font-weight: 700;
            padding: 4px 0;
        }

        .receipt-total-line.govt {
            color: #c0392b;
        }

        .receipt-total-line.profit {
            color: #27ae60;
        }

        .receipt-footer {
            text-align: center;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 2px dashed #999;
            font-size: 11px;
            color: #555;
            line-height: 1.6;
        }

        .receipt-footer strong {
            display: block;
            font-size: 12px;
            color: #c0392b;
            margin-top: 6px;
        }

        .receipt-barcode {
            text-align: center;
            margin-top: 14px;
            font-size: 8px;
            letter-spacing: 2px;
            color: #999;
        }

        .receipt-barcode-bars {
            display: flex;
            justify-content: center;
            gap: 1px;
            margin-bottom: 4px;
        }

        .receipt-barcode-bars span {
            display: inline-block;
            width: 1px;
            background: #333;
        }

        /* ==========================================
           SHARE BUTTONS
        ========================================== */
        .share-bar {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 16px 20px 8px;
        }

        .share-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 10px 18px;
            border-radius: 20px;
            border: 1px solid var(--border);
            background: var(--bg-card);
            color: var(--text-secondary);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .share-btn:active {
            transform: scale(0.96);
        }

        .share-btn svg {
            width: 16px;
            height: 16px;
            fill: currentColor;
        }

        .share-btn.share-x {
            border-color: rgba(255,255,255,0.15);
        }

        .share-btn.share-x:hover {
            background: #1a1a1a;
            color: var(--text-primary);
        }

        .share-btn.share-save {
            border-color: rgba(46, 213, 115, 0.3);
            color: var(--green);
        }

        .share-btn.share-save:hover {
            background: rgba(46, 213, 115, 0.1);
        }

        .share-btn.share-copy {
            border-color: rgba(69, 170, 242, 0.3);
            color: var(--blue);
        }

        .share-btn.share-copy:hover {
            background: rgba(69, 170, 242, 0.1);
        }

        .share-btn.share-fb {
            border-color: rgba(66, 103, 178, 0.3);
            color: #4267B2;
        }

        .share-btn.share-fb:hover {
            background: rgba(66, 103, 178, 0.1);
        }

        .share-btn .tick {
            display: none;
        }

        .share-btn.copied .tick {
            display: inline;
        }

        .share-btn.copied .copy-icon {
            display: none;
        }

        /* ==========================================
           DECLINE TIMELINE
        ========================================== */
        .decline-timeline {
            margin-top: 20px;
            padding: 16px;
            background: rgba(0,0,0,0.2);
            border-radius: var(--radius-md);
        }

        .decline-timeline-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-tertiary);
            margin-bottom: 12px;
            font-family: var(--font-mono);
        }

        .decline-timeline svg {
            width: 100%;
            height: 180px;
        }

        .decline-timeline-events {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .timeline-event {
            font-size: 9px;
            padding: 4px 8px;
            border-radius: 3px;
            font-family: var(--font-mono);
            letter-spacing: 0.3px;
        }

        .timeline-event.bad {
            background: rgba(255, 71, 87, 0.15);
            color: var(--red);
            border: 1px solid rgba(255, 71, 87, 0.2);
        }

        .timeline-event.good {
            background: rgba(46, 213, 115, 0.15);
            color: var(--green);
            border: 1px solid rgba(46, 213, 115, 0.2);
        }

        /* ==========================================
           LIVE TAX COUNTER
        ========================================== */
        .live-counter {
            position: fixed;
            bottom: 70px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(20, 12, 12, 0.95);
            border: 1px solid rgba(255, 71, 87, 0.3);
            border-radius: 20px;
            padding: 8px 20px;
            z-index: 900;
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            display: flex;
            align-items: center;
            gap: 8px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease, transform 0.4s ease;
            transform: translateX(-50%) translateY(20px);
            white-space: nowrap;
        }

        .live-counter.visible {
            opacity: 1;
            pointer-events: auto;
            transform: translateX(-50%) translateY(0);
        }

        .live-counter-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--red);
            animation: pulse-dot 2s infinite;
        }

        @keyframes pulse-dot {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .live-counter-text {
            font-size: 11px;
            color: var(--text-tertiary);
        }

        .live-counter-value {
            font-family: var(--font-mono);
            font-size: 13px;
            font-weight: 700;
            color: var(--red);
        }

        /* ==========================================
           GOVERNMENT'S CUT
        ========================================== */
        .govt-cut {
            padding: 0 20px 8px;
        }

        .govt-cut-card {
            background: linear-gradient(135deg, #1a0a0a 0%, var(--bg-card) 40%);
            border: 1px solid rgba(255, 71, 87, 0.3);
            border-radius: var(--radius-lg);
            padding: 24px 20px;
            position: relative;
            overflow: hidden;
        }

        .govt-cut-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--red), var(--amber), var(--red));
        }

        .govt-cut-headline {
            font-family: var(--font-mono);
            font-size: 28px;
            font-weight: 700;
            color: var(--red);
            text-align: center;
            margin-bottom: 4px;
        }

        .govt-cut-subhead {
            font-size: 13px;
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 24px;
            line-height: 1.5;
        }

        .govt-cut-subhead span {
            color: var(--text-primary);
            font-weight: 700;
        }

        .govt-hit-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .govt-hit {
            background: rgba(255, 71, 87, 0.06);
            border: 1px solid rgba(255, 71, 87, 0.15);
            border-radius: var(--radius-sm);
            padding: 14px 12px;
        }

        .govt-hit-label {
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--red);
            font-weight: 600;
            margin-bottom: 6px;
        }

        .govt-hit-value {
            font-family: var(--font-mono);
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .govt-hit-desc {
            font-size: 10px;
            color: var(--text-tertiary);
            line-height: 1.4;
        }

        .govt-hit-full {
            grid-column: 1 / -1;
        }

        .govt-vat-compare {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 16px 0;
            padding: 16px;
            background: rgba(0,0,0,0.3);
            border-radius: var(--radius-md);
        }

        .govt-vat-item {
            flex: 1;
            text-align: center;
        }

        .govt-vat-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-tertiary);
            margin-bottom: 6px;
        }

        .govt-vat-value {
            font-family: var(--font-mono);
            font-size: 22px;
            font-weight: 700;
        }

        .govt-vat-divider {
            width: 1px;
            height: 40px;
            background: var(--border);
        }

        .govt-cut-callout {
            background: rgba(255, 71, 87, 0.08);
            border: 1px solid rgba(255, 71, 87, 0.2);
            border-left: 3px solid var(--red);
            border-radius: var(--radius-sm);
            padding: 16px;
            margin-top: 16px;
        }

        .govt-cut-callout p {
            font-size: 14px;
            color: var(--text-primary);
            line-height: 1.6;
            font-weight: 500;
        }

        .govt-cut-callout span {
            color: var(--red);
            font-weight: 700;
            font-family: var(--font-mono);
        }

        /* ==========================================
           COMMUNITY IMPACT
        ========================================== */
        .community-impact {
            padding: 0 20px 8px;
        }

        .community-impact-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 20px;
        }

        .community-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .community-stat {
            text-align: center;
            padding: 12px 8px;
            background: var(--bg-elevated);
            border-radius: var(--radius-sm);
        }

        .community-stat-value {
            font-family: var(--font-mono);
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 6px;
        }

        .community-stat-label {
            font-size: 10px;
            color: var(--text-tertiary);
            line-height: 1.4;
        }

        .community-context {
            display: flex;
            flex-direction: column;
            gap: 14px;
            margin-bottom: 20px;
        }

        .community-context-item {
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }

        .community-context-icon {
            font-size: 18px;
            min-width: 28px;
            text-align: center;
            padding-top: 2px;
        }

        .community-context-text {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .community-quote {
            font-style: italic;
            font-size: 13px;
            color: var(--text-tertiary);
            line-height: 1.6;
            padding: 16px;
            border-left: 2px solid var(--amber);
            background: var(--bg-elevated);
            border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
        }

        /* ==========================================
           ANIMATIONS
        ========================================== */
        .fade-up {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease, transform 0.6s ease;
        }

        .fade-up.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Stagger children */
        .stagger > *:nth-child(1) { transition-delay: 0s; }
        .stagger > *:nth-child(2) { transition-delay: 0.08s; }
        .stagger > *:nth-child(3) { transition-delay: 0.16s; }
        .stagger > *:nth-child(4) { transition-delay: 0.24s; }
        .stagger > *:nth-child(5) { transition-delay: 0.32s; }
        .stagger > *:nth-child(6) { transition-delay: 0.4s; }

        /* Pulse animation for live indicator */
        .live-dot {
            width: 6px;
            height: 6px;
            background: var(--green);
            border-radius: 50%;
            display: inline-block;
            animation: pulse 2s ease infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; box-shadow: 0 0 0 0 var(--green-glow); }
            50% { opacity: 0.7; box-shadow: 0 0 0 6px transparent; }
        }

        /* Number count-up */
        .count-up {
            font-variant-numeric: tabular-nums;
        }

        /* Shimmer for loading feel */
        @keyframes shimmer {
            0% { background-position: -200% center; }
            100% { background-position: 200% center; }
        }

        /* ==========================================
           SPOONS EXPLORER
        ========================================== */
        .explorer {
            padding: 0 20px 24px;
        }

        .explorer-search {
            position: relative;
            margin-bottom: 16px;
        }

        .explorer-search-icon {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
        }

        .explorer-search-icon svg {
            width: 16px;
            height: 16px;
            stroke: var(--text-tertiary);
            fill: none;
            stroke-width: 2;
        }

        .explorer-search input {
            width: 100%;
            padding: 12px 12px 12px 40px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-family: var(--font-sans);
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s;
        }

        .explorer-search input::placeholder {
            color: var(--text-tertiary);
        }

        .explorer-search input:focus {
            border-color: var(--green);
        }

        .explorer-sort {
            display: flex;
            gap: 6px;
            margin-bottom: 16px;
            overflow-x: auto;
            scrollbar-width: none;
        }

        .explorer-sort::-webkit-scrollbar { display: none; }

        .explorer-sort-btn {
            padding: 6px 12px;
            font-family: var(--font-mono);
            font-size: 11px;
            font-weight: 600;
            color: var(--text-tertiary);
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }

        .explorer-sort-btn.active {
            background: var(--green-dim);
            color: var(--green);
            border-color: rgba(0, 212, 161, 0.3);
        }

        .explorer-stats {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .explorer-stat-pill {
            padding: 6px 12px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            font-family: var(--font-mono);
            font-size: 11px;
            flex: 1;
            text-align: center;
        }

        .explorer-stat-pill .val {
            font-weight: 700;
            color: var(--text-primary);
            display: block;
            font-size: 16px;
            margin-bottom: 2px;
        }

        .explorer-stat-pill .lbl {
            color: var(--text-tertiary);
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .explorer-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .explorer-pub {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            padding: 14px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: background 0.2s, border-color 0.2s;
        }

        .explorer-pub:active {
            background: var(--bg-card-hover);
        }

        .explorer-pub-left {
            flex: 1;
            min-width: 0;
        }

        .explorer-pub-rank {
            font-family: var(--font-mono);
            font-size: 10px;
            font-weight: 600;
            color: var(--text-tertiary);
            margin-bottom: 2px;
        }

        .explorer-pub-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .explorer-pub-location {
            font-size: 12px;
            color: var(--text-tertiary);
            margin-top: 2px;
        }

        .explorer-pub-right {
            text-align: right;
            flex-shrink: 0;
            margin-left: 12px;
        }

        .explorer-pub-price {
            font-family: var(--font-mono);
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .explorer-pub-range {
            font-family: var(--font-mono);
            font-size: 10px;
            color: var(--text-tertiary);
            margin-top: 2px;
        }

        .explorer-pub-cheapest {
            font-size: 11px;
            color: var(--green);
            font-weight: 500;
            margin-top: 2px;
        }

        .explorer-more {
            padding: 14px;
            text-align: center;
            font-family: var(--font-mono);
            font-size: 13px;
            font-weight: 600;
            color: var(--green);
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            cursor: pointer;
            margin-top: 8px;
            transition: background 0.2s;
        }

        .explorer-more:active {
            background: var(--bg-card-hover);
        }

        /* Expanded pub detail */
        .explorer-pub-detail {
            display: none;
            padding: 0 16px 14px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-top: none;
            border-radius: 0 0 var(--radius-md) var(--radius-md);
            margin-top: -9px;
        }

        .explorer-pub.expanded {
            border-radius: var(--radius-md) var(--radius-md) 0 0;
        }

        .explorer-pub.expanded + .explorer-pub-detail {
            display: block;
        }

        .explorer-drink-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-light);
        }

        .explorer-drink-row:last-child {
            border-bottom: none;
        }

        .explorer-drink-name {
            font-size: 13px;
            color: var(--text-secondary);
            flex: 1;
        }

        .explorer-drink-abv {
            font-family: var(--font-mono);
            font-size: 10px;
            color: var(--text-tertiary);
            margin: 0 12px;
        }

        .explorer-drink-price {
            font-family: var(--font-mono);
            font-size: 13px;
            font-weight: 700;
            color: var(--text-primary);
        }

        /* ==========================================
           NEAREST PINT — GEOLOCATION HERO
        ========================================== */
        .nearest {
            padding: 0 20px 24px;
        }

        .nearest-card {
            background: linear-gradient(135deg, rgba(0, 212, 161, 0.08) 0%, var(--bg-card) 50%);
            border: 1px solid rgba(0, 212, 161, 0.2);
            border-radius: var(--radius-lg);
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .nearest-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -30%;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(0, 212, 161, 0.08) 0%, transparent 70%);
            pointer-events: none;
        }

        .nearest-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .nearest-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--green);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: var(--font-mono);
        }

        .nearest-gps {
            font-size: 11px;
            color: var(--text-tertiary);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .nearest-gps .dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--green);
            animation: pulse 2s ease infinite;
        }

        .nearest-pub {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-light);
        }

        .nearest-pub:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .nearest-pub-rank {
            font-family: var(--font-mono);
            font-size: 24px;
            font-weight: 700;
            color: var(--text-tertiary);
            width: 32px;
            text-align: center;
            flex-shrink: 0;
        }

        .nearest-pub-info {
            flex: 1;
            min-width: 0;
        }

        .nearest-pub-name {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .nearest-pub-detail {
            font-size: 12px;
            color: var(--text-tertiary);
            margin-top: 2px;
        }

        .nearest-pub-dist {
            font-family: var(--font-mono);
            font-size: 11px;
            color: var(--green);
            font-weight: 600;
            margin-top: 2px;
        }

        .nearest-pub-price {
            text-align: right;
            flex-shrink: 0;
        }

        .nearest-pub-price .price {
            font-family: var(--font-mono);
            font-size: 20px;
            font-weight: 700;
            color: var(--green);
        }

        .nearest-pub-price .beer {
            font-size: 11px;
            color: var(--text-tertiary);
            margin-top: 2px;
        }

        .nearest-enable {
            text-align: center;
            padding: 20px;
        }

        .nearest-enable-btn {
            padding: 12px 24px;
            background: var(--green-dim);
            border: 1px solid rgba(0, 212, 161, 0.3);
            border-radius: var(--radius-md);
            color: var(--green);
            font-family: var(--font-mono);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nearest-enable-btn:active {
            background: rgba(0, 212, 161, 0.2);
        }

        .nearest-enable-hint {
            font-size: 11px;
            color: var(--text-tertiary);
            margin-top: 8px;
        }

        /* ==========================================
           PRICE DISTRIBUTION
        ========================================== */
        .distribution {
            padding: 0 20px 24px;
        }

        .distribution-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 20px;
        }

        .distribution-bars {
            display: flex;
            align-items: flex-end;
            gap: 2px;
            height: 100px;
            margin-bottom: 8px;
        }

        .distribution-bar {
            flex: 1;
            border-radius: 2px 2px 0 0;
            min-height: 2px;
            transition: height 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            cursor: pointer;
        }

        .distribution-bar:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: calc(100% + 4px);
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            padding: 4px 8px;
            border-radius: 4px;
            font-family: var(--font-mono);
            font-size: 10px;
            color: var(--text-primary);
            white-space: nowrap;
            z-index: 10;
        }

        .distribution-labels {
            display: flex;
            justify-content: space-between;
            font-family: var(--font-mono);
            font-size: 10px;
            color: var(--text-tertiary);
        }

        .distribution-median {
            text-align: center;
            margin-top: 12px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .distribution-median strong {
            color: var(--text-primary);
            font-family: var(--font-mono);
        }

        /* ==========================================
           CHEAPEST BEER CALLOUT
        ========================================== */
        .cheapest-hero {
            padding: 0 20px 24px;
        }

        .cheapest-hero-card {
            background: linear-gradient(135deg, rgba(0, 212, 161, 0.06) 0%, rgba(74, 144, 255, 0.06) 100%);
            border: 1px solid rgba(0, 212, 161, 0.15);
            border-radius: var(--radius-lg);
            padding: 24px 20px;
            text-align: center;
        }

        .cheapest-hero-label {
            font-family: var(--font-mono);
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--green);
            font-weight: 600;
            margin-bottom: 12px;
        }

        .cheapest-hero-price {
            font-family: var(--font-mono);
            font-size: 48px;
            font-weight: 700;
            color: var(--green);
            letter-spacing: -2px;
            line-height: 1;
        }

        .cheapest-hero-beer {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-top: 8px;
        }

        .cheapest-hero-pub {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .cheapest-hero-sub {
            font-size: 11px;
            color: var(--text-tertiary);
            margin-top: 12px;
            font-family: var(--font-mono);
        }

        /* Candle animation */
        @keyframes candleGrow {
            from { transform: scaleY(0); }
            to { transform: scaleY(1); }
        }

        .candle {
            transform-origin: bottom;
            animation: candleGrow 0.6s ease forwards;
        }

        /* Chart line draw */
        .chart-line-animate {
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
            animation: drawLine 2s ease forwards;
        }

        @keyframes drawLine {
            to { stroke-dashoffset: 0; }
        }

        .chart-area-animate {
            opacity: 0;
            animation: fadeIn 1s ease 1.5s forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }
    </style>
</head>
<body>

    <!-- LOADER -->
    <div class="loader" id="loader">
        <div class="loader-logo">PONR<span>.pub</span></div>
        <div class="loader-bar"><div class="loader-bar-fill"></div></div>
        <div class="loader-text">LOADING 778 PUBS THE GOVERNMENT IS TAXING TO DEATH...</div>
    </div>

    <!-- CONCEPT BADGE -->
    <div class="concept-badge">Loading data...</div>

    <!-- STATUS BAR -->
    <div class="status-bar">
        <div class="status-bar-time" id="statusTime">9:41</div>
        <div class="status-bar-icons">
            <svg viewBox="0 0 16 16"><path d="M1 10l3-3 3 3 3-5 3 2" stroke="currentColor" fill="none" stroke-width="1.5"/></svg>
            <svg viewBox="0 0 16 16"><rect x="1" y="4" width="11" height="8" rx="1" stroke="currentColor" fill="none" stroke-width="1.2"/><rect x="3" y="6" width="7" height="4" rx="0.5" fill="currentColor"/><rect x="12" y="6.5" width="2" height="3" rx="0.5" fill="currentColor"/></svg>
        </div>
    </div>

    <!-- APP HEADER -->
    <header class="app-header">
        <div class="app-logo">
            <div class="app-logo-icon"><img src="logo-web.jpg" alt="PPI"></div>
            <div class="app-logo-text">Pint<span>ofNoReturn</span></div>
        </div>
        <div class="header-actions">
            <div class="header-btn">
                <svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="7"/><line x1="16.5" y1="16.5" x2="21" y2="21"/></svg>
            </div>
            <div class="header-btn">
                <svg viewBox="0 0 24 24"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
                <div class="notification-dot"></div>
            </div>
        </div>
    </header>

    <!-- LIVE TICKER -->
    <div class="ticker-wrap">
        <div class="ticker" id="ticker">
            <!-- Populated by JS -->
        </div>
    </div>

    <!-- PORTFOLIO -->
    <section class="portfolio fade-up">
        <div class="portfolio-label">Avg. Spoons Pint — 778 pubs tracked</div>
        <div class="portfolio-value">
            <span class="currency">£</span><span class="count-up" data-target="3.22">0.00</span>
        </div>
        <div class="portfolio-change">
            <span class="positive">▼ £1.61 cheaper than national avg</span> <span class="label">· ONS national: £4.83</span>
        </div>

        <div class="portfolio-stats stagger">
            <div class="portfolio-stat fade-up">
                <div class="portfolio-stat-label">Spoons Avg</div>
                <div class="portfolio-stat-value green">£3.22</div>
            </div>
            <div class="portfolio-stat fade-up">
                <div class="portfolio-stat-label">Your Local</div>
                <div class="portfolio-stat-value red">£4.83</div>
            </div>
            <div class="portfolio-stat fade-up">
                <div class="portfolio-stat-label">The Gap</div>
                <div class="portfolio-stat-value amber">£1.61</div>
            </div>
        </div>
    </section>

    <!-- CHART -->
    <section class="chart-section fade-up">
        <div class="chart-header">
            <div>
                <div class="chart-pub-name">UK Avg. Pint <span class="live-dot"></span></div>
                <div class="chart-pub-type">ONS National Average · Loading...</div>
            </div>
            <div class="chart-current">
                <div class="chart-current-price">£4.83</div>
                <div class="chart-current-change">▲ £0.14 (3.0%)</div>
            </div>
        </div>

        <div class="chart-canvas" id="chartCanvas">
            <svg viewBox="0 0 350 200" preserveAspectRatio="none">
                <defs>
                    <linearGradient id="chartGrad" x1="0" y1="0" x2="0" y2="1">
                        <stop offset="0%" stop-color="var(--red)" stop-opacity="0.25"/>
                        <stop offset="100%" stop-color="var(--red)" stop-opacity="0"/>
                    </linearGradient>
                    <linearGradient id="chartGradGreen" x1="0" y1="0" x2="0" y2="1">
                        <stop offset="0%" stop-color="var(--green)" stop-opacity="0.2"/>
                        <stop offset="100%" stop-color="var(--green)" stop-opacity="0"/>
                    </linearGradient>
                </defs>

                <!-- Grid lines -->
                <line x1="0" y1="50" x2="350" y2="50" stroke="var(--border-light)" stroke-width="0.5" stroke-dasharray="4,4"/>
                <line x1="0" y1="100" x2="350" y2="100" stroke="var(--border-light)" stroke-width="0.5" stroke-dasharray="4,4"/>
                <line x1="0" y1="150" x2="350" y2="150" stroke="var(--border-light)" stroke-width="0.5" stroke-dasharray="4,4"/>

                <!-- Price labels -->
                <text x="340" y="48" fill="var(--text-tertiary)" font-size="8" font-family="var(--font-mono)" text-anchor="end">£6.20</text>
                <text x="340" y="98" fill="var(--text-tertiary)" font-size="8" font-family="var(--font-mono)" text-anchor="end">£5.60</text>
                <text x="340" y="148" fill="var(--text-tertiary)" font-size="8" font-family="var(--font-mono)" text-anchor="end">£5.00</text>

                <!-- Area fill -->
                <path class="chart-area-animate" d="M0,160 L25,155 50,150 75,140 100,142 125,130 150,128 175,120 200,125 225,115 250,100 275,95 300,80 325,60 350,45 350,200 0,200Z" fill="url(#chartGrad)"/>

                <!-- Price line -->
                <polyline class="chart-line-animate" points="0,160 25,155 50,150 75,140 100,142 125,130 150,128 175,120 200,125 225,115 250,100 275,95 300,80 325,60 350,45" fill="none" stroke="var(--red)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>

                <!-- Current price dot -->
                <circle cx="350" cy="45" r="4" fill="var(--red)" opacity="0">
                    <animate attributeName="opacity" from="0" to="1" begin="2s" dur="0.3s" fill="freeze"/>
                </circle>
                <circle cx="350" cy="45" r="8" fill="var(--red)" opacity="0">
                    <animate attributeName="opacity" values="0;0.3;0" begin="2s" dur="2s" repeatCount="indefinite"/>
                    <animate attributeName="r" values="4;12;4" begin="2s" dur="2s" repeatCount="indefinite"/>
                </circle>
            </svg>
        </div>

        <div class="chart-time-toggles">
            <button class="chart-time-btn">1D</button>
            <button class="chart-time-btn">1W</button>
            <button class="chart-time-btn active">1M</button>
            <button class="chart-time-btn">6M</button>
            <button class="chart-time-btn">1Y</button>
            <button class="chart-time-btn">ALL</button>
        </div>
    </section>

    <!-- CHEAPEST BEER IN THE UK RIGHT NOW -->
    <div class="cheapest-hero fade-up" id="cheapestHero" style="display:none;">
        <div class="cheapest-hero-card">
            <div class="cheapest-hero-label">Cheapest pint in the UK right now</div>
            <div class="cheapest-hero-price" id="cheapestHeroPrice">£—</div>
            <div class="cheapest-hero-beer" id="cheapestHeroBeer">—</div>
            <div class="cheapest-hero-pub" id="cheapestHeroPub">—</div>
            <div class="cheapest-hero-sub" id="cheapestHeroSub">—</div>
        </div>
    </div>

    <!-- THE GAP — WHY YOUR LOCAL CAN'T COMPETE -->
    <div class="section-header fade-up" id="gapHeader">
        <div class="section-title">The Gap</div>
        <div class="section-link" style="color: var(--red);">Why your local can't compete</div>
    </div>

    <div class="gap-section fade-up" id="gapSection">
        <div class="gap-cards">
            <div class="gap-card">
                <div class="gap-card-label">Supermarket</div>
                <div class="gap-card-price" style="color: var(--green);">£1.20</div>
                <div class="gap-card-sub">500ml can at home</div>
                <div class="gap-card-bar"><div class="gap-bar-fill" style="width: 25%; background: var(--green);"></div></div>
            </div>
            <div class="gap-card gap-card-spoons">
                <div class="gap-card-label">Spoons Avg</div>
                <div class="gap-card-price" id="gapSpoonsPrice" style="color: var(--amber);">£3.22</div>
                <div class="gap-card-sub">778 pubs nationwide</div>
                <div class="gap-card-bar"><div class="gap-bar-fill" id="gapSpoonsBar" style="width: 67%; background: var(--amber);"></div></div>
            </div>
            <div class="gap-card">
                <div class="gap-card-label">Your Local</div>
                <div class="gap-card-price" style="color: var(--red);">£4.83</div>
                <div class="gap-card-sub">ONS national average</div>
                <div class="gap-card-bar"><div class="gap-bar-fill" style="width: 100%; background: var(--red);"></div></div>
            </div>
        </div>
        <div class="gap-callout">
            <p>An independent needs <span>£4.00–£4.50</span> just to break even — <span>33%</span> of that goes straight to the government. Then in April 2025, they hiked NI, slashed rates relief, and raised the minimum wage. <span>15,800 pubs</span> have closed since 2000. The government just made it harder to keep the rest open.</p>
        </div>
        <div style="font-size: 10px; color: var(--text-tertiary); margin-top: 12px; font-family: var(--font-mono); letter-spacing: 0.3px;">Source: BBPA / ONS / Wetherspoons JDW Apps API</div>
    </div>

    <!-- FIND NEAREST CHEAP PINT -->
    <div class="section-header fade-up" id="nearestHeader" style="display:none;">
        <div class="section-title">Nearest Cheap Pint</div>
        <div class="section-link" style="color: var(--green);">GPS</div>
    </div>

    <div class="nearest fade-up" id="nearestSection" style="display:none;">
        <div class="nearest-card" id="nearestCard">
            <!-- Populated by JS -->
        </div>
    </div>

    <!-- MARKET MOVERS -->
    <div class="section-header">
        <div class="section-title">Market Movers</div>
        <div class="section-link">See all →</div>
    </div>

    <div class="movers" id="movers">
        <div class="mover-card drop">
            <div class="mover-pub">The Brown Bear</div>
            <div class="mover-type">Sheffield · Sam Smith's</div>
            <div class="mover-price">£2.40</div>
            <div class="mover-change down">▼ 4.0%</div>
            <div class="mover-sparkline">
                <svg viewBox="0 0 120 32" preserveAspectRatio="none">
                    <polyline points="0,5 15,8 30,12 45,10 60,15 75,18 90,22 105,25 120,28" fill="none" stroke="var(--green)" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
            </div>
        </div>
        <div class="mover-card drop">
            <div class="mover-pub">The Globe</div>
            <div class="mover-type">Sheffield · John Smith's</div>
            <div class="mover-price">£2.55</div>
            <div class="mover-change down">▼ 3.8%</div>
            <div class="mover-sparkline">
                <svg viewBox="0 0 120 32" preserveAspectRatio="none">
                    <polyline points="0,4 15,6 30,5 45,10 60,12 75,16 90,20 105,24 120,30" fill="none" stroke="var(--green)" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
            </div>
        </div>
        <div class="mover-card rise">
            <div class="mover-pub">Sheffield Tap</div>
            <div class="mover-type">Sheffield · Craft Cask</div>
            <div class="mover-price">£5.20</div>
            <div class="mover-change up">▲ 6.1%</div>
            <div class="mover-sparkline">
                <svg viewBox="0 0 120 32" preserveAspectRatio="none">
                    <polyline points="0,28 15,25 30,22 45,24 60,18 75,15 90,10 105,8 120,4" fill="none" stroke="var(--red)" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
            </div>
        </div>
        <div class="mover-card rise">
            <div class="mover-pub">True North</div>
            <div class="mover-type">Sheffield · Craft Brewery</div>
            <div class="mover-price">£5.20</div>
            <div class="mover-change up">▲ 4.2%</div>
            <div class="mover-sparkline">
                <svg viewBox="0 0 120 32" preserveAspectRatio="none">
                    <polyline points="0,30 15,26 30,24 45,20 60,18 75,14 90,12 105,8 120,5" fill="none" stroke="var(--red)" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
            </div>
        </div>
        <div class="mover-card drop">
            <div class="mover-pub">Wetherspoons</div>
            <div class="mover-type">Woodseats Palace · Lager</div>
            <div class="mover-price">£2.97</div>
            <div class="mover-change down">▼ 2.3%</div>
            <div class="mover-sparkline">
                <svg viewBox="0 0 120 32" preserveAspectRatio="none">
                    <polyline points="0,8 15,10 30,12 45,14 60,16 75,18 90,22 105,26 120,28" fill="none" stroke="var(--green)" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
            </div>
        </div>
    </div>

    <!-- WATCHLIST -->
    <div class="section-header">
        <div class="section-title">Your Watchlist</div>
        <div class="section-link">Edit</div>
    </div>

    <div class="watchlist stagger">
        <div class="watchlist-item fade-up">
            <div class="watchlist-left">
                <div class="watchlist-icon" style="background: var(--red-dim);">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--red)" stroke-width="2"><path d="M18 8h1a4 4 0 010 8h-1M2 8h16v9a4 4 0 01-4 4H6a4 4 0 01-4-4V8z"/><path d="M6 1v3M10 1v3M14 1v3"/></svg>
                </div>
                <div class="watchlist-info">
                    <div class="watchlist-name">Sheffield Tap</div>
                    <div class="watchlist-meta">Platform 1 · Craft Bar</div>
                </div>
            </div>
            <div class="watchlist-center">
                <svg viewBox="0 0 64 32" preserveAspectRatio="none">
                    <polyline points="0,24 8,22 16,20 24,18 32,19 40,15 48,12 56,8 64,5" fill="none" stroke="var(--red)" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
            </div>
            <div class="watchlist-right">
                <div class="watchlist-price">£5.20</div>
                <div class="watchlist-change up">+6.1%</div>
            </div>
        </div>

        <div class="watchlist-item fade-up">
            <div class="watchlist-left">
                <div class="watchlist-icon" style="background: var(--green-dim);">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--green)" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                </div>
                <div class="watchlist-info">
                    <div class="watchlist-name">The Brown Bear</div>
                    <div class="watchlist-meta">Norfolk St · Sam Smith's</div>
                </div>
            </div>
            <div class="watchlist-center">
                <svg viewBox="0 0 64 32" preserveAspectRatio="none">
                    <polyline points="0,8 8,10 16,12 24,14 32,16 40,20 48,22 56,26 64,28" fill="none" stroke="var(--green)" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
            </div>
            <div class="watchlist-right">
                <div class="watchlist-price">£2.40</div>
                <div class="watchlist-change down">-4.0%</div>
            </div>
        </div>

        <div class="watchlist-item fade-up">
            <div class="watchlist-left">
                <div class="watchlist-icon" style="background: var(--amber-dim);">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--amber)" stroke-width="2"><path d="M18 8h1a4 4 0 010 8h-1M2 8h16v9a4 4 0 01-4 4H6a4 4 0 01-4-4V8z"/><path d="M6 1v3M10 1v3M14 1v3"/></svg>
                </div>
                <div class="watchlist-info">
                    <div class="watchlist-name">Kelham Island Tavern</div>
                    <div class="watchlist-meta">Kelham · Cask Ale · CAMRA award</div>
                </div>
            </div>
            <div class="watchlist-center">
                <svg viewBox="0 0 64 32" preserveAspectRatio="none">
                    <polyline points="0,16 8,16 16,15 24,16 32,16 40,15 48,16 56,16 64,15" fill="none" stroke="var(--text-tertiary)" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
            </div>
            <div class="watchlist-right">
                <div class="watchlist-price">£4.20</div>
                <div class="watchlist-change flat">+1.2%</div>
            </div>
        </div>

        <div class="watchlist-item fade-up">
            <div class="watchlist-left">
                <div class="watchlist-icon" style="background: var(--blue-dim);">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--blue)" stroke-width="2"><path d="M18 8h1a4 4 0 010 8h-1M2 8h16v9a4 4 0 01-4 4H6a4 4 0 01-4-4V8z"/><path d="M6 1v3M10 1v3M14 1v3"/></svg>
                </div>
                <div class="watchlist-info">
                    <div class="watchlist-name">Fagans</div>
                    <div class="watchlist-meta">Broad Lane · Traditional</div>
                </div>
            </div>
            <div class="watchlist-center">
                <svg viewBox="0 0 64 32" preserveAspectRatio="none">
                    <polyline points="0,18 8,17 16,18 24,16 32,15 40,14 48,12 56,10 64,8" fill="none" stroke="var(--red)" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
            </div>
            <div class="watchlist-right">
                <div class="watchlist-price">£4.20</div>
                <div class="watchlist-change up">+2.4%</div>
            </div>
        </div>

        <div class="watchlist-item fade-up">
            <div class="watchlist-left">
                <div class="watchlist-icon" style="background: var(--green-dim);">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--green)" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg>
                </div>
                <div class="watchlist-info">
                    <div class="watchlist-name">Wetherspoons</div>
                    <div class="watchlist-meta">Woodseats Palace · Chain</div>
                </div>
            </div>
            <div class="watchlist-center">
                <svg viewBox="0 0 64 32" preserveAspectRatio="none">
                    <polyline points="0,12 8,14 16,15 24,16 32,18 40,20 48,22 56,25 64,27" fill="none" stroke="var(--green)" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
            </div>
            <div class="watchlist-right">
                <div class="watchlist-price">£2.97</div>
                <div class="watchlist-change down">-2.3%</div>
            </div>
        </div>
    </div>

    <!-- PRICE ALERTS -->
    <div class="section-header">
        <div class="section-title">Price Alerts</div>
        <div class="section-link">Manage</div>
    </div>

    <div class="alerts stagger">
        <div class="alert-card fade-up">
            <div class="alert-icon drop">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--green)" stroke-width="2"><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/><polyline points="17 18 23 18 23 12"/></svg>
            </div>
            <div class="alert-content">
                <div class="alert-title">Brown Bear holds at £2.40</div>
                <div class="alert-desc">Sam Smith's XXXX Best — cheapest pint in Sheffield. Sam Smith's keep prices low by banning phones.</div>
            </div>
            <div class="alert-time">2m</div>
        </div>

        <div class="alert-card fade-up">
            <div class="alert-icon rise">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--red)" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>
            </div>
            <div class="alert-content">
                <div class="alert-title">Sheffield avg up 13.8% since 2023</div>
                <div class="alert-desc">CAMRA Beer Capital Survey: real ale avg hit £4.13 — up 50p from Feb 2023</div>
            </div>
            <div class="alert-time">18m</div>
        </div>

        <div class="alert-card fade-up">
            <div class="alert-icon info">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--blue)" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
            </div>
            <div class="alert-content">
                <div class="alert-title">Beer duty up 3.66% from Feb 2026</div>
                <div class="alert-desc">RPI uprating adds ~2p/pint. Government's 1p "draught relief cut" already wiped out.</div>
            </div>
            <div class="alert-time">1h</div>
        </div>
    </div>

    <!-- REGIONAL INDEX -->
    <div class="section-header">
        <div class="section-title">Regional Index</div>
        <div class="section-link">Full map →</div>
    </div>

    <div class="regional fade-up">
        <div class="regional-card">
            <div class="regional-row">
                <div class="regional-rank">1</div>
                <div class="regional-name">London</div>
                <div class="regional-bar-wrap">
                    <div class="regional-bar" style="width: 100%; background: var(--red);"></div>
                </div>
                <div class="regional-price">£6.10</div>
            </div>
            <div class="regional-row">
                <div class="regional-rank">2</div>
                <div class="regional-name">South East</div>
                <div class="regional-bar-wrap">
                    <div class="regional-bar" style="width: 81%; background: var(--red);"></div>
                </div>
                <div class="regional-price">£4.94</div>
            </div>
            <div class="regional-row">
                <div class="regional-rank">3</div>
                <div class="regional-name">South West</div>
                <div class="regional-bar-wrap">
                    <div class="regional-bar" style="width: 80.8%; background: var(--amber);"></div>
                </div>
                <div class="regional-price">£4.93</div>
            </div>
            <div class="regional-row">
                <div class="regional-rank">4</div>
                <div class="regional-name">Scotland</div>
                <div class="regional-bar-wrap">
                    <div class="regional-bar" style="width: 78.7%; background: var(--amber);"></div>
                </div>
                <div class="regional-price">£4.80</div>
            </div>
            <div class="regional-row">
                <div class="regional-rank">5</div>
                <div class="regional-name">North West</div>
                <div class="regional-bar-wrap">
                    <div class="regional-bar" style="width: 78.7%; background: var(--amber);"></div>
                </div>
                <div class="regional-price">£4.80</div>
            </div>
            <div class="regional-row">
                <div class="regional-rank">6</div>
                <div class="regional-name">Wales</div>
                <div class="regional-bar-wrap">
                    <div class="regional-bar" style="width: 77.7%; background: var(--amber);"></div>
                </div>
                <div class="regional-price">£4.74</div>
            </div>
            <div class="regional-row">
                <div class="regional-rank">7</div>
                <div class="regional-name">Midlands</div>
                <div class="regional-bar-wrap">
                    <div class="regional-bar" style="width: 76.7%; background: var(--green);"></div>
                </div>
                <div class="regional-price">£4.68</div>
            </div>
            <div class="regional-row">
                <div class="regional-rank">8</div>
                <div class="regional-name">Sheffield</div>
                <div class="regional-bar-wrap">
                    <div class="regional-bar" style="width: 67.7%; background: var(--green);"></div>
                </div>
                <div class="regional-price">£4.13</div>
            </div>
        </div>
        <div style="font-size: 10px; color: var(--text-tertiary); margin-top: 10px; font-family: var(--font-mono); letter-spacing: 0.3px;">Source: Morning Advertiser Pint Price Survey 2025 · CAMRA Sheffield Beer Capital Survey</div>
    </div>

    <!-- ============================================
         STATEMENT ZONE — editorial break from terminal
         ============================================ -->
    <div class="statement-zone">
        <div class="statement-divider">
            <div class="statement-divider-label">Beyond the numbers</div>
            <div class="statement-divider-headline">Your pint is paying for a crisis the government created.</div>
            <div class="statement-divider-sub">Every price above has a story behind it. Scroll to read it.</div>
        </div>

    <!-- PINT CALCULATOR -->
    <div class="section-header fade-up" id="storySection">
        <div class="section-title">Tax Your Pint</div>
        <div class="section-link">Interactive</div>
    </div>

    <div class="pint-calc fade-up">
        <div class="pint-calc-card">
            <div class="pint-calc-prompt">What did you pay for your last pint?</div>
            <div class="pint-calc-input-wrap">
                <span class="currency-symbol">£</span>
                <input type="number" class="pint-calc-input" id="pintCalcInput" value="4.83" step="0.01" min="1" max="15">
            </div>
            <div class="pint-calc-breakdown" id="pintCalcBreakdown">
                <div class="pint-calc-row govt-row">
                    <span class="pint-calc-row-label">HM Treasury (duty, VAT, rates)</span>
                    <span class="pint-calc-row-value" style="color: var(--red);" id="calcGovt">£1.61</span>
                </div>
                <div class="pint-calc-row">
                    <span class="pint-calc-row-label">Brewery / supplier</span>
                    <span class="pint-calc-row-value" style="color: var(--amber);" id="calcBrewery">£1.05</span>
                </div>
                <div class="pint-calc-row">
                    <span class="pint-calc-row-label">Rent & overheads</span>
                    <span class="pint-calc-row-value" style="color: var(--blue);" id="calcRent">£1.16</span>
                </div>
                <div class="pint-calc-row">
                    <span class="pint-calc-row-label">Staff wages</span>
                    <span class="pint-calc-row-value" style="color: var(--teal);" id="calcStaff">£0.86</span>
                </div>
                <div class="pint-calc-row profit-row">
                    <span class="pint-calc-row-label">Your publican keeps</span>
                    <span class="pint-calc-row-value" id="calcProfit">£0.12</span>
                </div>
            </div>
            <div class="pint-calc-total">
                <div class="pint-calc-total-label">Government : Publican<span>For every £1 the publican keeps</span></div>
                <div class="pint-calc-total-ratio" id="calcRatio">13:1</div>
            </div>
            <div class="pint-calc-pints-needed" id="calcPintsNeeded">
                At 12p profit per pint, your publican needs to sell <strong>344 pints per day</strong> to earn minimum wage (£12.21/hr, 60hr weeks).
            </div>
        </div>
    </div>

    <!-- THE REAL COST — WHY YOUR LOCAL NEEDS £4.83 -->
    <div class="section-header fade-up">
        <div class="section-title">Why Your Local Needs £4.83</div>
        <div class="section-link">Where every penny goes</div>
    </div>

    <div class="narrative-cost fade-up">
        <div class="narrative-cost-card">
            <div class="narrative-cost-intro">
                This is where every penny of your pint goes. The government takes <strong>£1.61</strong> — a third of the glass. The publican who pulled it keeps <strong>12p</strong>.
            </div>

            <div class="narrative-bar-track" id="narrativeCostBar">
                <div class="narrative-bar-segment narrative-seg-duty" style="width: 33.4%;">33%</div>
                <div class="narrative-bar-segment narrative-seg-brewery" style="width: 21.7%;">22%</div>
                <div class="narrative-bar-segment narrative-seg-rent" style="width: 24.1%;">24%</div>
                <div class="narrative-bar-segment narrative-seg-staff" style="width: 17.8%;">18%</div>
                <div class="narrative-bar-segment narrative-seg-profit" style="width: 3%;font-size:8px;">3%</div>
            </div>

            <div class="narrative-bar-labels">
                <div class="narrative-bar-label" style="width: 33.4%;">
                    <div class="narrative-bar-label-name">Tax (Duty, VAT, Rates)</div>
                    <div class="narrative-bar-label-value" style="color: var(--red);">£1.61</div>
                </div>
                <div class="narrative-bar-label" style="width: 21.7%;">
                    <div class="narrative-bar-label-name">Brewery / Supplier</div>
                    <div class="narrative-bar-label-value" style="color: var(--amber);">£1.05</div>
                </div>
                <div class="narrative-bar-label" style="width: 24.1%;">
                    <div class="narrative-bar-label-name">Rent & Overheads</div>
                    <div class="narrative-bar-label-value" style="color: var(--blue);">£1.16</div>
                </div>
                <div class="narrative-bar-label" style="width: 17.8%;">
                    <div class="narrative-bar-label-name">Staff</div>
                    <div class="narrative-bar-label-value" style="color: var(--teal);">£0.86</div>
                </div>
                <div class="narrative-bar-label" style="width: 3%;">
                    <div class="narrative-bar-label-name">Profit</div>
                    <div class="narrative-bar-label-value" style="color: var(--green);">12p</div>
                </div>
            </div>

            <div class="narrative-cost-callout">
                <p>The government takes <span>£1.61</span>. The publican keeps <span>12p</span>. That's a 13:1 ratio. The average publican earns £15,000/year — below the minimum wage they're legally required to pay their own staff.</p>
            </div>
        </div>
    </div>

    <!-- THE RECEIPT -->
    <div class="section-header fade-up">
        <div class="section-title">The Receipt</div>
        <div class="section-link">Where it really goes</div>
    </div>

    <div class="receipt-section fade-up">
        <div class="receipt">
            <div class="receipt-header">
                <div class="receipt-pub-name">THE KING'S HEAD</div>
                <div class="receipt-pub-sub">Your Local Since 1847</div>
            </div>

            <div class="receipt-line">
                <span>1x Pint, Bitter</span>
                <span id="rcptTotal">£4.83</span>
            </div>

            <div class="receipt-dashed"></div>

            <div class="receipt-line" style="font-weight:700;">
                <span>OF WHICH:</span>
                <span></span>
            </div>

            <div class="receipt-line indent govt-line">
                <span>Beer duty</span>
                <span id="rcptDuty">£0.35</span>
            </div>
            <div class="receipt-line indent govt-line">
                <span>VAT (20%)</span>
                <span id="rcptVat">£0.81</span>
            </div>
            <div class="receipt-line indent govt-line">
                <span>Business rates</span>
                <span id="rcptRates">£0.45</span>
            </div>
            <div class="receipt-line indent">
                <span>Brewery / supplier</span>
                <span id="rcptBrewery">£1.05</span>
            </div>
            <div class="receipt-line indent">
                <span>Rent & overheads</span>
                <span id="rcptRent">£1.16</span>
            </div>
            <div class="receipt-line indent">
                <span>Staff wages</span>
                <span id="rcptStaff">£0.89</span>
            </div>

            <div class="receipt-double"></div>

            <div class="receipt-total-line govt">
                <span>HM TREASURY</span>
                <span id="rcptGovtTotal">£1.61</span>
            </div>
            <div class="receipt-total-line profit">
                <span>YOUR PUBLICAN</span>
                <span id="rcptProfit">£0.12</span>
            </div>

            <div class="receipt-footer">
                The government earns more
                from your pint than the person
                who poured it.
                <strong id="rcptRatio">13x more.</strong>
            </div>

            <div class="receipt-barcode">
                <div class="receipt-barcode-bars">
                    <span style="height:18px"></span><span style="height:18px;width:2px"></span><span style="height:18px"></span><span style="height:18px"></span><span style="height:18px;width:2px"></span><span style="height:18px"></span><span style="height:18px;width:3px"></span><span style="height:18px"></span><span style="height:18px"></span><span style="height:18px;width:2px"></span><span style="height:18px"></span><span style="height:18px"></span><span style="height:18px;width:2px"></span><span style="height:18px;width:3px"></span><span style="height:18px"></span><span style="height:18px"></span><span style="height:18px;width:2px"></span><span style="height:18px"></span><span style="height:18px;width:2px"></span><span style="height:18px"></span><span style="height:18px"></span><span style="height:18px;width:3px"></span><span style="height:18px"></span><span style="height:18px;width:2px"></span><span style="height:18px"></span>
                </div>
                PONR-2025-15800-LOST
            </div>
        </div>
    </div>

    <div class="share-bar fade-up">
        <button class="share-btn share-save" onclick="shareReceipt()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
            Save receipt
        </button>
        <button class="share-btn share-x" onclick="shareToX()">
            <svg viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
            Post
        </button>
        <button class="share-btn share-fb" onclick="shareToFacebook()">
            <svg viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
            Share
        </button>
        <button class="share-btn share-copy" onclick="copyLink()">
            <svg class="copy-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
            <span class="tick">Copied</span>
            <span class="copy-icon">Copy link</span>
        </button>
    </div>

    <!-- WHY SPOONS CAN UNDERCUT -->
    <div class="section-header fade-up">
        <div class="section-title">Why Spoons Can Do It for Less</div>
        <div class="section-link">The advantage</div>
    </div>

    <div class="spoons-advantage fade-up">
        <div class="spoons-advantage-card">
            <div class="advantage-row">
                <div class="advantage-icon" style="background: var(--green-dim); color: var(--green);">-50p</div>
                <div class="advantage-text">
                    <div class="advantage-title">Bulk buying power</div>
                    <div class="advantage-desc">800+ pubs. Direct brewery deals. 15-25% below what your local pays per barrel.</div>
                </div>
            </div>
            <div class="advantage-row">
                <div class="advantage-icon" style="background: var(--green-dim); color: var(--green);">-40p</div>
                <div class="advantage-text">
                    <div class="advantage-title">Fewer staff per pint</div>
                    <div class="advantage-desc">App-based ordering. No table service. Standardised menus — no chefs needed.</div>
                </div>
            </div>
            <div class="advantage-row">
                <div class="advantage-icon" style="background: var(--green-dim); color: var(--green);">-30p</div>
                <div class="advantage-text">
                    <div class="advantage-title">Lower rent per pint</div>
                    <div class="advantage-desc">Huge venues in converted banks and cinemas. Volume spreads costs thin.</div>
                </div>
            </div>
            <div class="advantage-row">
                <div class="advantage-icon" style="background: var(--teal-dim); color: var(--teal);">£0</div>
                <div class="advantage-text">
                    <div class="advantage-title">No music, no sport</div>
                    <div class="advantage-desc">No PRS licensing fees. No Sky Sports subscription. Keeps overheads minimal.</div>
                </div>
            </div>
            <div class="advantage-callout">
                <p>An independent needs <span>£4.00+</span> to survive. Spoons can profit at <span>£2.85</span>. That's not a level playing field — it's a structural advantage that no local can match.</p>
            </div>
            <div style="font-size: 10px; color: var(--text-tertiary); margin-top: 12px; font-family: var(--font-mono); letter-spacing: 0.3px;">Source: BBPA / BII Benchmarking / Wetherspoons Annual Report 2024</div>
        </div>
    </div>

    <!-- THE GOVERNMENT'S CUT -->
    <div class="section-header fade-up">
        <div class="section-title">The Government's Cut</div>
        <div class="section-link" style="color: var(--red);">April 2025</div>
    </div>

    <div class="govt-cut fade-up">
        <div class="govt-cut-card">
            <div class="govt-cut-headline">33p in every £1</div>
            <div class="govt-cut-subhead">goes straight to the Treasury. Then in April 2025, <span>they hiked taxes again</span>.</div>

            <div class="govt-hit-grid">
                <div class="govt-hit">
                    <div class="govt-hit-label">Business rates relief</div>
                    <div class="govt-hit-value">75% → 40%</div>
                    <div class="govt-hit-desc">Slashed overnight. £500m cost to hospitality.</div>
                </div>
                <div class="govt-hit">
                    <div class="govt-hit-label">Employer NI</div>
                    <div class="govt-hit-value">13.8% → 15%</div>
                    <div class="govt-hit-desc">Threshold dropped from £9,100 to £5,000.</div>
                </div>
                <div class="govt-hit">
                    <div class="govt-hit-label">Total April hit</div>
                    <div class="govt-hit-value">£3.4bn</div>
                    <div class="govt-hit-desc">Combined tax hike facing hospitality sector.</div>
                </div>
                <div class="govt-hit">
                    <div class="govt-hit-label">Operating at a loss</div>
                    <div class="govt-hit-value">1 in 3</div>
                    <div class="govt-hit-desc">Pubs now unprofitable. Only 1 in 4 hospitality businesses are in the black.</div>
                </div>
                <div class="govt-hit govt-hit-full">
                    <div class="govt-hit-label">Jobs lost since October 2024 budget</div>
                    <div class="govt-hit-value">89,000</div>
                    <div class="govt-hit-desc">More than half of all UK job losses in that period came from hospitality.</div>
                </div>
            </div>

            <div class="govt-vat-compare">
                <div class="govt-vat-item">
                    <div class="govt-vat-label">Pub food VAT</div>
                    <div class="govt-vat-value" style="color: var(--red);">20%</div>
                </div>
                <div class="govt-vat-divider"></div>
                <div class="govt-vat-item">
                    <div class="govt-vat-label">Supermarket food VAT</div>
                    <div class="govt-vat-value" style="color: var(--green);">0%</div>
                </div>
            </div>

            <div class="govt-cut-callout">
                <p>The government takes <span>£1.61</span> from every pint. The publican who poured it keeps <span>12p</span>. Then they wonder why pubs are closing.</p>
            </div>
            <div style="font-size: 10px; color: var(--text-tertiary); margin-top: 12px; font-family: var(--font-mono); letter-spacing: 0.3px;">Source: BBPA · UKHospitality · ONS · House of Commons Library · HMRC duty rates</div>
        </div>
    </div>

    <!-- THE DECLINE — PUB CLOSURE CRISIS -->
    <div class="section-header fade-up">
        <div class="section-title">The Decline</div>
        <div class="section-link" style="color: var(--red);">Since 2000</div>
    </div>

    <div class="narrative-closures fade-up">
        <div class="narrative-closures-card">
            <div class="narrative-closures-bg"></div>
            <div class="narrative-closures-counter">
                <span class="count-up" data-target="15800" data-format="integer" id="closureCounter">0</span>
            </div>
            <div class="narrative-closures-subtitle">pubs lost since 2000</div>
            <div class="narrative-closures-rate">One pub closing every single day</div>

            <div class="narrative-closures-stats">
                <div class="narrative-closures-stat">
                    <div class="narrative-closures-stat-value">60,800</div>
                    <div class="narrative-closures-stat-label">Pubs in 2000</div>
                </div>
                <div class="narrative-closures-stat">
                    <div class="narrative-closures-stat-value">45,000</div>
                    <div class="narrative-closures-stat-label">Pubs remain</div>
                </div>
                <div class="narrative-closures-stat">
                    <div class="narrative-closures-stat-value" style="color: var(--red);">-26%</div>
                    <div class="narrative-closures-stat-label">In 25 years</div>
                </div>
            </div>

            <div class="decline-split">
                <div class="decline-split-item">
                    <div class="decline-split-value" style="color: var(--red);">-16.6%</div>
                    <div class="decline-split-label">Independent pubs since 2020</div>
                </div>
                <div class="decline-split-divider"></div>
                <div class="decline-split-item">
                    <div class="decline-split-value" style="color: var(--green);">+4.2%</div>
                    <div class="decline-split-label">Managed chains since 2020</div>
                </div>
            </div>

            <div class="narrative-closures-quote">
                The pubs closing are overwhelmingly small, independently owned locals. The chains are growing. The government is watching.
            </div>

            <!-- DECLINE TIMELINE CHART -->
            <div class="decline-timeline">
                <div class="decline-timeline-label">25 years of decline</div>
                <svg viewBox="0 0 600 180" preserveAspectRatio="none" id="declineTimeline">
                    <!-- Filled area -->
                    <defs>
                        <linearGradient id="declineGrad" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="0%" stop-color="rgba(255,71,87,0.25)"/>
                            <stop offset="100%" stop-color="rgba(255,71,87,0)"/>
                        </linearGradient>
                    </defs>
                    <!-- Grid lines -->
                    <line x1="0" y1="20" x2="600" y2="20" stroke="rgba(255,255,255,0.05)" stroke-width="1"/>
                    <line x1="0" y1="60" x2="600" y2="60" stroke="rgba(255,255,255,0.05)" stroke-width="1"/>
                    <line x1="0" y1="100" x2="600" y2="100" stroke="rgba(255,255,255,0.05)" stroke-width="1"/>
                    <line x1="0" y1="140" x2="600" y2="140" stroke="rgba(255,255,255,0.05)" stroke-width="1"/>
                    <!-- Y axis labels -->
                    <text x="4" y="16" fill="rgba(255,255,255,0.3)" font-size="9" font-family="monospace">60k</text>
                    <text x="4" y="60" fill="rgba(255,255,255,0.3)" font-size="9" font-family="monospace">55k</text>
                    <text x="4" y="100" fill="rgba(255,255,255,0.3)" font-size="9" font-family="monospace">50k</text>
                    <text x="4" y="140" fill="rgba(255,255,255,0.3)" font-size="9" font-family="monospace">45k</text>
                    <!-- Area fill -->
                    <path d="M0,20 L25,22 L75,30 L125,38 L175,50 L200,56 L250,72 L300,80 L350,88 L400,104 L450,108 L500,120 L550,128 L600,140 L600,180 L0,180 Z" fill="url(#declineGrad)"/>
                    <!-- Main line: 2000-2024 -->
                    <polyline points="0,20 25,22 75,30 125,38 175,50 200,56 250,72 300,80 350,88 400,104 450,108 500,120 550,128 600,140" fill="none" stroke="var(--red)" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <!-- Event markers -->
                    <!-- 2008: Beer duty escalator -->
                    <line x1="200" y1="50" x2="200" y2="170" stroke="rgba(255,71,87,0.4)" stroke-width="1" stroke-dasharray="3,3"/>
                    <text x="202" y="168" fill="rgba(255,71,87,0.6)" font-size="7" font-family="monospace">2008</text>
                    <!-- 2013: Escalator scrapped -->
                    <line x1="325" y1="84" x2="325" y2="170" stroke="rgba(46,213,115,0.4)" stroke-width="1" stroke-dasharray="3,3"/>
                    <text x="327" y="168" fill="rgba(46,213,115,0.6)" font-size="7" font-family="monospace">2013</text>
                    <!-- 2020: COVID -->
                    <line x1="500" y1="120" x2="500" y2="170" stroke="rgba(255,71,87,0.4)" stroke-width="1" stroke-dasharray="3,3"/>
                    <text x="502" y="168" fill="rgba(255,71,87,0.6)" font-size="7" font-family="monospace">2020</text>
                    <!-- 2025: Tax hikes -->
                    <circle cx="600" cy="140" r="4" fill="var(--red)" stroke="var(--bg-primary)" stroke-width="2"/>
                    <!-- Data points -->
                    <circle cx="0" cy="20" r="3" fill="var(--text-primary)"/>
                    <text x="4" y="14" fill="var(--text-primary)" font-size="8" font-family="monospace" font-weight="700">60,800</text>
                    <text x="560" y="154" fill="var(--red)" font-size="8" font-family="monospace" font-weight="700">45,000</text>
                    <!-- X axis labels -->
                    <text x="0" y="178" fill="rgba(255,255,255,0.3)" font-size="8" font-family="monospace">2000</text>
                    <text x="570" y="178" fill="rgba(255,255,255,0.3)" font-size="8" font-family="monospace">2024</text>
                </svg>
                <div class="decline-timeline-events">
                    <div class="timeline-event bad">2008 Beer duty escalator (+42% over 5 years)</div>
                    <div class="timeline-event good">2013 Escalator scrapped</div>
                    <div class="timeline-event bad">2020 COVID lockdowns</div>
                    <div class="timeline-event bad">2025 NI hike + rates relief cut</div>
                </div>
            </div>

            <div style="font-size: 10px; color: var(--text-tertiary); margin-top: 16px; font-family: var(--font-mono); letter-spacing: 0.3px;">Source: BBPA · ONS · CGA / AlixPartners Hospitality Market Monitor · CAMRA 2025</div>
        </div>
    </div>

    <!-- WHAT WE'RE LOSING — COMMUNITY IMPACT -->
    <div class="section-header fade-up">
        <div class="section-title">What We're Losing</div>
        <div class="section-link">It's not just beer</div>
    </div>

    <div class="community-impact fade-up">
        <div class="community-impact-card">
            <div class="community-stats">
                <div class="community-stat">
                    <div class="community-stat-value" style="color: var(--red);">86%</div>
                    <div class="community-stat-label">say their community suffers when a pub closes</div>
                </div>
                <div class="community-stat">
                    <div class="community-stat-value" style="color: var(--amber);">60%</div>
                    <div class="community-stat-label">concerned about increased loneliness from pub closures</div>
                </div>
                <div class="community-stat">
                    <div class="community-stat-value" style="color: var(--blue);">1 in 5</div>
                    <div class="community-stat-label">UK pubs are technically insolvent — negative net assets</div>
                </div>
            </div>

            <div class="community-context">
                <div class="community-context-item">
                    <div class="community-context-icon">🏠</div>
                    <div class="community-context-text">Closed pubs become flats, Tesco Express, or boarded-up shells. In many villages, the pub was the last remaining community space.</div>
                </div>
                <div class="community-context-item">
                    <div class="community-context-icon">🇫🇷</div>
                    <div class="community-context-text">It's not just us. France lost 460,000 bistros since 1900. They're now seeking UNESCO heritage status to save what's left.</div>
                </div>
                <div class="community-context-item">
                    <div class="community-context-icon">💷</div>
                    <div class="community-context-text">The pub industry supports 1 million jobs and contributes £34 billion to the UK economy. 51% of the workforce is under 25.</div>
                </div>
                <div class="community-context-item">
                    <div class="community-context-icon">🏛️</div>
                    <div class="community-context-text">The government collected £837m in tax from Wetherspoons alone last year — over £1m per pub. Then cut their rates relief in half.</div>
                </div>
            </div>

            <div class="community-quote">
                "I've been consoled in there, I've consoled friends in there. We've chopped up family issues, work issues. We've drunk for the sake of drinking in there."
            </div>
            <div style="font-size: 10px; color: var(--text-tertiary); margin-top: 12px; font-family: var(--font-mono); letter-spacing: 0.3px;">Source: Loughborough Uni / Campaign to End Loneliness "Open Arms" report · BBPA · France UNESCO bid 2024</div>
        </div>
    </div>

    <!-- MARKET NEWS -->
    <div class="section-header">
        <div class="section-title">Market Analysis</div>
        <div class="section-link">More →</div>
    </div>

    <div class="news stagger">
        <div class="news-card fade-up">
            <div class="news-eyebrow" style="color: var(--red);">Government</div>
            <div class="news-title">April 2025: NI hiked, rates relief slashed, minimum wage up 6.7%. Total cost to pubs: £3.4 billion. One in three now operating at a loss.</div>
            <div class="news-meta">
                <div class="news-source">UKHospitality / House of Commons Library</div>
                <div class="news-time">2025</div>
            </div>
        </div>

        <div class="news-card fade-up">
            <div class="news-eyebrow" style="color: var(--red);">VAT inequality</div>
            <div class="news-title">Pubs pay 20% VAT on food. Supermarkets pay 0%. The government has known about this for years. Nothing has changed.</div>
            <div class="news-meta">
                <div class="news-source">BBPA / Tim Martin Tax Equality Campaign</div>
                <div class="news-time">2025</div>
            </div>
        </div>

        <div class="news-card fade-up">
            <div class="news-eyebrow" style="color: var(--red);">Jobs</div>
            <div class="news-title">89,000 hospitality jobs lost since the October 2024 budget. More than half of all UK job losses in that period. 5,600 more projected from 2025 closures.</div>
            <div class="news-meta">
                <div class="news-source">UKHospitality / BBPA</div>
                <div class="news-time">2025</div>
            </div>
        </div>

        <div class="news-card fade-up">
            <div class="news-eyebrow">Crisis</div>
            <div class="news-title">Independent pubs down 16.6% since 2020. Managed chains up 4.2%. The squeeze is structural, not cyclical — and the government just made it worse.</div>
            <div class="news-meta">
                <div class="news-source">ONS / CGA AlixPartners</div>
                <div class="news-time">2025</div>
            </div>
        </div>
    </div>

    </div><!-- end .statement-zone -->

    <!-- LIVE TAX COUNTER (floating) -->
    <div class="live-counter" id="liveCounter">
        <div class="live-counter-dot"></div>
        <span class="live-counter-text">Treasury revenue since you opened this page:</span>
        <span class="live-counter-value" id="liveCounterValue">£0</span>
    </div>

    <!-- PRICE DISTRIBUTION -->
    <div class="section-header fade-up" id="distHeader" style="display:none;">
        <div class="section-title">Price Distribution</div>
        <div class="section-link" id="distCount">—</div>
    </div>

    <div class="distribution fade-up" id="distSection" style="display:none;">
        <div class="distribution-card">
            <div class="distribution-bars" id="distBars"></div>
            <div class="distribution-labels">
                <span id="distMin">£—</span>
                <span id="distMax">£—</span>
            </div>
            <div class="distribution-median" id="distMedian"></div>
        </div>
    </div>

    <!-- SPOONS EXPLORER -->
    <div class="section-header fade-up">
        <div class="section-title">Spoons Explorer</div>
        <div class="section-link" id="explorerCount">Loading...</div>
    </div>

    <div class="explorer fade-up" id="explorerSection">
        <div class="explorer-stats" id="explorerStats">
            <div class="explorer-stat-pill">
                <span class="val" id="spoonsTotalPubs">---</span>
                <span class="lbl">Pubs</span>
            </div>
            <div class="explorer-stat-pill">
                <span class="val" id="spoonsAvgPint">---</span>
                <span class="lbl">Avg Pint</span>
            </div>
            <div class="explorer-stat-pill">
                <span class="val" id="spoonsCheapest">---</span>
                <span class="lbl">Cheapest</span>
            </div>
        </div>

        <div class="explorer-search">
            <div class="explorer-search-icon">
                <svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="7"/><line x1="16.5" y1="16.5" x2="21" y2="21"/></svg>
            </div>
            <input type="text" id="explorerSearch" placeholder="Search pubs, towns, postcodes...">
        </div>

        <div class="explorer-sort" id="explorerSort">
            <button class="explorer-sort-btn active" data-sort="cheapest">Cheapest first</button>
            <button class="explorer-sort-btn" data-sort="expensive">Priciest first</button>
            <button class="explorer-sort-btn" data-sort="name">A-Z</button>
            <button class="explorer-sort-btn" data-sort="beers">Most beers</button>
        </div>

        <div class="explorer-list" id="explorerList">
            <!-- Populated by JS -->
        </div>

        <div class="explorer-more" id="explorerMore" style="display:none;">
            Show more pubs
        </div>

        <div style="font-size: 10px; color: var(--text-tertiary); margin-top: 12px; font-family: var(--font-mono); letter-spacing: 0.3px;" id="spoonsSource">
            Source: Wetherspoons JDW Apps API · Live prices
        </div>
    </div>

    <!-- Spacer for bottom bar -->
    <div style="height: 32px;"></div>

    <!-- BOTTOM TAB BAR -->
    <nav class="tab-bar">
        <div class="tab-item active" data-scroll="top">
            <svg viewBox="0 0 24 24"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
            <span>Markets</span>
        </div>
        <div class="tab-item" data-scroll="#storySection">
            <svg viewBox="0 0 24 24"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
            <span>Story</span>
        </div>
        <div class="tab-item" data-scroll="#explorerSection">
            <svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="7"/><line x1="16.5" y1="16.5" x2="21" y2="21"/></svg>
            <span>Explorer</span>
        </div>
        <div class="tab-item" data-scroll="#gapHeader">
            <svg viewBox="0 0 24 24"><path d="M18 20V10M12 20V4M6 20v-6"/></svg>
            <span>Policy</span>
        </div>
    </nav>

    <script>
        // ==========================================
        // APP STATE
        // ==========================================
        let APP_DATA = null;   // ONS national data
        let SPOONS = null;     // Wetherspoons pub data

        // ==========================================
        // LOADER — fetch both datasets
        // ==========================================
        window.addEventListener('load', async () => {
            const [onsRes, spoonsRes] = await Promise.allSettled([
                fetch('data.json').then(r => r.json()),
                fetch('spoons.json').then(r => r.json())
            ]);

            if (onsRes.status === 'fulfilled') APP_DATA = onsRes.value;
            if (spoonsRes.status === 'fulfilled') SPOONS = spoonsRes.value;

            initApp();
            setTimeout(() => {
                document.getElementById('loader').classList.add('hidden');
            }, 2200);
        });

        function initApp() {
            updateTime();
            setInterval(updateTime, 30000);
            buildTicker();
            initChartFromData();
            initTabBar();
            initTickerSimulation();

            // Wetherspoons data
            if (SPOONS) {
                updatePortfolioFromSpoons();
                buildRegionalFromSpoons();
                buildMoversFromSpoons();
                buildCheapestHero();
                buildDistribution();
                buildDynamicWatchlist();
                buildDynamicAlerts();
                initNearest();
                initExplorer();
            }

            // Show data freshness
            const badge = document.querySelector('.concept-badge');
            if (badge) {
                const parts = [];
                if (APP_DATA?.lastUpdated) parts.push(`ONS: ${APP_DATA.lastUpdated}`);
                if (SPOONS?.meta?.fetchDate) parts.push(`Spoons: ${SPOONS.meta.fetchDate}`);
                badge.textContent = parts.join(' · ') || 'Loading...';
            }

            // Scroll reveal AFTER all dynamic content is built
            initScrollReveal();
            initCountUp();
        }

        // ==========================================
        // STATUS BAR TIME
        // ==========================================
        function updateTime() {
            const now = new Date();
            const h = now.getHours().toString().padStart(2, '0');
            const m = now.getMinutes().toString().padStart(2, '0');
            document.getElementById('statusTime').textContent = `${h}:${m}`;
        }

        // ==========================================
        // LIVE TICKER — from data.json
        // ==========================================
        function buildTicker() {
            let tickerData = [];

            if (SPOONS && SPOONS.pubs && SPOONS.pubs.length) {
                // Use real Wetherspoons data — sample ~20 diverse pubs
                const pubs = SPOONS.pubs;
                const step = Math.max(1, Math.floor(pubs.length / 20));
                const sampled = [];
                for (let i = 0; i < pubs.length && sampled.length < 20; i += step) {
                    sampled.push(pubs[i]);
                }
                tickerData = sampled.map(p => {
                    const diff = ((p.avg - SPOONS.meta.avgPint) / SPOONS.meta.avgPint * 100);
                    return {
                        name: p.name.replace(/^The /, '').substring(0, 20),
                        price: p.avg.toFixed(2),
                        change: (diff >= 0 ? '+' : '') + diff.toFixed(1) + '%',
                        dir: diff >= 0 ? 'up' : 'down'
                    };
                });
            } else if (APP_DATA) {
                const pubs = APP_DATA.sheffield?.pubs || [];
                tickerData = pubs.map(p => ({
                    name: p.ticker,
                    price: p.price.toFixed(2),
                    change: (p.change >= 0 ? '+' : '') + p.change.toFixed(1) + '%',
                    dir: p.change >= 0 ? 'up' : 'down'
                }));
            }

            const tickerEl = document.getElementById('ticker');
            const tickerHTML = [...tickerData, ...tickerData].map(t => `
                <div class="ticker-item">
                    <span class="ticker-name">${t.name}</span>
                    <span class="ticker-price">£${t.price}</span>
                    <span class="ticker-change ${t.dir}">${t.change}</span>
                </div>
            `).join('');
            tickerEl.innerHTML = tickerHTML;
        }

        // ==========================================
        // SCROLL REVEAL
        // ==========================================
        function initScrollReveal() {
            // Above-the-fold elements appear instantly (no transition)
            const vh = window.innerHeight;
            document.querySelectorAll('.fade-up').forEach(el => {
                if (el.getBoundingClientRect().top < vh) {
                    el.style.transition = 'none';
                    el.classList.add('visible');
                    // Re-enable transition for any future changes
                    requestAnimationFrame(() => { el.style.transition = ''; });
                }
            });
            // Below-fold elements get scroll-triggered reveal
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) entry.target.classList.add('visible');
                });
            }, { threshold: 0.1, rootMargin: '0px 0px -40px 0px' });
            document.querySelectorAll('.fade-up:not(.visible)').forEach(el => observer.observe(el));
        }

        // ==========================================
        // COUNT UP ANIMATION
        // ==========================================
        function initCountUp() {
            const vh = window.innerHeight;
            document.querySelectorAll('.count-up').forEach(el => {
                const target = parseFloat(el.dataset.target);
                if (el.getBoundingClientRect().top < vh) {
                    // Above the fold: show final value immediately
                    const isInteger = el.dataset.format === 'integer';
                    el.textContent = isInteger ? Math.round(target).toLocaleString('en-GB') : target.toFixed(2);
                    el.dataset.counted = '1';
                }
            });
            const countObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting && !entry.target.dataset.counted) {
                        const el = entry.target;
                        const target = parseFloat(el.dataset.target);
                        animateCount(el, 0, target, 1500);
                        el.dataset.counted = '1';
                        countObserver.unobserve(el);
                    }
                });
            }, { threshold: 0.5 });
            document.querySelectorAll('.count-up:not([data-counted])').forEach(el => countObserver.observe(el));
        }

        function animateCount(el, start, end, duration) {
            const isInteger = el.dataset.format === 'integer';
            const startTime = performance.now();
            function update(now) {
                const elapsed = now - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const eased = 1 - Math.pow(1 - progress, 4);
                const current = start + (end - start) * eased;
                if (isInteger) {
                    el.textContent = Math.round(current).toLocaleString('en-GB');
                } else {
                    el.textContent = current.toFixed(2);
                }
                if (progress < 1) requestAnimationFrame(update);
            }
            requestAnimationFrame(update);
        }

        // ==========================================
        // INTERACTIVE CHART — real ONS data
        // ==========================================
        let chartMonthly = [];

        function initChartFromData() {
            if (!APP_DATA) return;
            chartMonthly = APP_DATA.national.monthly;

            // Wire up time toggles
            const btns = document.querySelectorAll('.chart-time-btn');
            const periods = { '1D': 1, '1W': 1, '1M': 1, '6M': 6, '1Y': 12, 'ALL': 9999 };

            btns.forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelector('.chart-time-btn.active').classList.remove('active');
                    btn.classList.add('active');
                    const months = periods[btn.textContent] || 12;
                    renderChart(months);
                });
            });

            // Render default (1Y)
            renderChart(12);
        }

        function renderChart(monthsBack) {
            if (!chartMonthly.length) return;

            const data = monthsBack >= 9999 ? chartMonthly : chartMonthly.slice(-monthsBack);
            if (data.length < 2) return;

            const prices = data.map(d => d.price);
            const minP = Math.min(...prices);
            const maxP = Math.max(...prices);
            const range = maxP - minP || 0.10;
            const padding = range * 0.1;

            const W = 350, H = 200, padTop = 20, padBot = 20;
            const usableH = H - padTop - padBot;

            // Build polyline points
            const points = prices.map((p, i) => {
                const x = (i / (prices.length - 1)) * W;
                const y = padTop + usableH - ((p - minP + padding) / (range + padding * 2)) * usableH;
                return `${x.toFixed(1)},${y.toFixed(1)}`;
            });

            const lastY = parseFloat(points[points.length - 1].split(',')[1]);
            const firstPrice = prices[0];
            const lastPrice = prices[prices.length - 1];
            const isUp = lastPrice >= firstPrice;
            const color = isUp ? 'var(--red)' : 'var(--green)';
            const gradId = isUp ? 'chartGrad' : 'chartGradGreen';

            // Price labels
            const midP = (minP + maxP) / 2;
            const topLabel = `£${maxP.toFixed(2)}`;
            const midLabel = `£${midP.toFixed(2)}`;
            const botLabel = `£${minP.toFixed(2)}`;

            // Area path (close to bottom)
            const areaPath = `M${points[0]} ${points.slice(1).map(p => `L${p}`).join(' ')} L${W},${H} L0,${H}Z`;

            const svg = `
                <svg viewBox="0 0 ${W} ${H}" preserveAspectRatio="none">
                    <defs>
                        <linearGradient id="dynGrad" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="0%" stop-color="${color}" stop-opacity="0.25"/>
                            <stop offset="100%" stop-color="${color}" stop-opacity="0"/>
                        </linearGradient>
                    </defs>
                    <line x1="0" y1="${padTop + usableH * 0.05}" x2="${W}" y2="${padTop + usableH * 0.05}" stroke="var(--border-light)" stroke-width="0.5" stroke-dasharray="4,4"/>
                    <line x1="0" y1="${padTop + usableH * 0.5}" x2="${W}" y2="${padTop + usableH * 0.5}" stroke="var(--border-light)" stroke-width="0.5" stroke-dasharray="4,4"/>
                    <line x1="0" y1="${padTop + usableH * 0.95}" x2="${W}" y2="${padTop + usableH * 0.95}" stroke="var(--border-light)" stroke-width="0.5" stroke-dasharray="4,4"/>
                    <text x="${W - 5}" y="${padTop + usableH * 0.05 - 2}" fill="var(--text-tertiary)" font-size="8" font-family="var(--font-mono)" text-anchor="end">${topLabel}</text>
                    <text x="${W - 5}" y="${padTop + usableH * 0.5 - 2}" fill="var(--text-tertiary)" font-size="8" font-family="var(--font-mono)" text-anchor="end">${midLabel}</text>
                    <text x="${W - 5}" y="${padTop + usableH * 0.95 - 2}" fill="var(--text-tertiary)" font-size="8" font-family="var(--font-mono)" text-anchor="end">${botLabel}</text>
                    <path d="${areaPath}" fill="url(#dynGrad)" class="chart-area-animate"/>
                    <polyline class="chart-line-animate" points="${points.join(' ')}" fill="none" stroke="${color}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <circle cx="${W}" cy="${lastY}" r="4" fill="${color}" opacity="0">
                        <animate attributeName="opacity" from="0" to="1" begin="1s" dur="0.3s" fill="freeze"/>
                    </circle>
                    <circle cx="${W}" cy="${lastY}" r="8" fill="${color}" opacity="0">
                        <animate attributeName="opacity" values="0;0.3;0" begin="1s" dur="2s" repeatCount="indefinite"/>
                        <animate attributeName="r" values="4;12;4" begin="1s" dur="2s" repeatCount="indefinite"/>
                    </circle>
                </svg>`;

            document.getElementById('chartCanvas').innerHTML = svg;

            // Update header with period change
            const change = lastPrice - firstPrice;
            const changePct = ((change / firstPrice) * 100).toFixed(1);
            const arrow = change >= 0 ? '▲' : '▼';
            const changeEl = document.querySelector('.chart-current-change');
            const priceEl = document.querySelector('.chart-current-price');
            if (changeEl) {
                changeEl.textContent = `${arrow} £${Math.abs(change).toFixed(2)} (${Math.abs(changePct)}%)`;
                changeEl.style.color = change >= 0 ? 'var(--red)' : 'var(--green)';
            }

            // Update date range label
            const dateLabel = document.querySelector('.chart-pub-type');
            if (dateLabel && data.length > 1) {
                const from = data[0].date;
                const to = data[data.length - 1].date;
                dateLabel.textContent = `ONS National Average · ${from} to ${to}`;
            }
        }

        // ==========================================
        // TAB BAR
        // ==========================================
        function initTabBar() {
            document.querySelectorAll('.tab-item').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelector('.tab-item.active').classList.remove('active');
                    tab.classList.add('active');
                    const target = tab.dataset.scroll;
                    if (target === 'top') {
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    } else {
                        const el = document.querySelector(target);
                        if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                });
            });
        }

        // ==========================================
        // PRICE TICKER SIMULATION
        // ==========================================
        function initTickerSimulation() {
            setInterval(() => {
                const items = document.querySelectorAll('.ticker-price');
                if (items.length === 0) return;
                const idx = Math.floor(Math.random() * items.length);
                const el = items[idx];
                const current = parseFloat(el.textContent.replace('£', ''));
                const delta = (Math.random() - 0.5) * 0.04;
                const newPrice = (current + delta).toFixed(2);
                el.textContent = `£${newPrice}`;
                el.style.color = delta > 0 ? 'var(--red)' : 'var(--green)';
                setTimeout(() => { el.style.color = ''; }, 600);
            }, 3000);
        }

        // ==========================================
        // SPOONS: UPDATE PORTFOLIO HEADER
        // ==========================================
        function updatePortfolioFromSpoons() {
            const meta = SPOONS.meta;
            // Update the portfolio label
            const label = document.querySelector('.portfolio-label');
            if (label) label.textContent = `Avg. Spoons Pint — ${meta.totalPubs} pubs tracked`;

            // Update the main price
            const countEl = document.querySelector('.portfolio-value .count-up');
            if (countEl) countEl.dataset.target = meta.avgPint;

            // Get ONS national avg
            const onsAvg = APP_DATA?.national?.current;
            const gap = onsAvg ? (onsAvg - meta.avgPint).toFixed(2) : null;

            // Update stats: Spoons Avg | Your Local | The Gap
            const stats = document.querySelectorAll('.portfolio-stat-value');
            const statLabels = document.querySelectorAll('.portfolio-stat-label');
            if (stats[0]) { stats[0].textContent = `£${meta.avgPint.toFixed(2)}`; stats[0].className = 'portfolio-stat-value green'; }
            if (statLabels[0]) statLabels[0].textContent = 'Spoons Avg';
            if (stats[1] && onsAvg) { stats[1].textContent = `£${onsAvg.toFixed(2)}`; stats[1].className = 'portfolio-stat-value red'; }
            if (statLabels[1] && onsAvg) statLabels[1].textContent = 'Your Local';
            if (stats[2] && gap) { stats[2].textContent = `£${gap}`; stats[2].className = 'portfolio-stat-value amber'; }
            if (statLabels[2] && gap) statLabels[2].textContent = 'The Gap';

            // Update change line — frame around the gap
            const changeEl = document.querySelector('.portfolio-change');
            if (changeEl) {
                changeEl.innerHTML = `<span class="positive">▼ £${gap} cheaper than national avg</span> <span class="label">· ONS national: £${onsAvg?.toFixed(2) || '4.83'}</span>`;
                changeEl.className = 'portfolio-change';
            }

            // Update Gap section if it exists
            const gapPrice = document.getElementById('gapSpoonsPrice');
            if (gapPrice) gapPrice.textContent = `£${meta.avgPint.toFixed(2)}`;
            const gapBar = document.getElementById('gapSpoonsBar');
            if (gapBar && onsAvg) gapBar.style.width = `${(meta.avgPint / onsAvg * 100).toFixed(0)}%`;
        }

        // ==========================================
        // SPOONS: BUILD REGIONAL FROM REAL DATA
        // ==========================================
        function buildRegionalFromSpoons() {
            const regional = SPOONS.regional;
            if (!regional || !regional.length) return;

            const card = document.querySelector('.regional-card');
            if (!card) return;

            const maxPrice = regional[0].avg;
            const minPrice = regional[regional.length - 1].avg;

            card.innerHTML = regional.slice(0, 10).map((r, i) => {
                const pct = ((r.avg - minPrice) / (maxPrice - minPrice) * 60 + 40).toFixed(0);
                const color = r.avg >= maxPrice * 0.9 ? 'var(--red)' :
                              r.avg >= maxPrice * 0.75 ? 'var(--amber)' : 'var(--green)';
                return `
                    <div class="regional-row">
                        <div class="regional-rank">${i + 1}</div>
                        <div class="regional-name">${r.name} <span style="font-size:10px;color:var(--text-tertiary)">(${r.pubs})</span></div>
                        <div class="regional-bar-wrap">
                            <div class="regional-bar" style="width:${pct}%;background:${color};"></div>
                        </div>
                        <div class="regional-price">£${r.avg.toFixed(2)}</div>
                    </div>`;
            }).join('');

            // Update source text
            const source = card.parentElement.querySelector('div[style*="font-size: 10px"]');
            if (source) source.textContent = `Source: Wetherspoons live prices · ${SPOONS.meta.fetchDate} · ${regional.length} regions`;
        }

        // ==========================================
        // SPOONS: BUILD MARKET MOVERS
        // ==========================================
        function buildMoversFromSpoons() {
            const container = document.getElementById('movers');
            if (!container) return;

            // Mix cheapest and priciest
            const cheapest = (SPOONS.cheapest || []).slice(0, 3);
            const priciest = (SPOONS.priciest || []).slice(0, 3);
            const movers = [];

            cheapest.forEach(p => movers.push({...p, type: 'drop'}));
            priciest.forEach(p => movers.push({...p, type: 'rise'}));

            container.innerHTML = movers.map(m => {
                const price = m.type === 'drop' ? m.min || m.avg : m.max || m.avg;
                const arrow = m.type === 'drop' ? '▼' : '▲';
                const diffFromAvg = ((price - SPOONS.meta.avgPint) / SPOONS.meta.avgPint * 100).toFixed(1);
                const sparkPoints = generateSparkline(m.type === 'drop');

                return `
                    <div class="mover-card ${m.type}">
                        <div class="mover-pub">${m.name}</div>
                        <div class="mover-type">${m.town} · Wetherspoons</div>
                        <div class="mover-price">£${price.toFixed(2)}</div>
                        <div class="mover-change ${m.type === 'drop' ? 'down' : 'up'}">${arrow} ${Math.abs(diffFromAvg)}% vs avg</div>
                        <div class="mover-sparkline">
                            <svg viewBox="0 0 120 32" preserveAspectRatio="none">
                                <polyline points="${sparkPoints}" fill="none" stroke="${m.type === 'drop' ? 'var(--green)' : 'var(--red)'}" stroke-width="1.5" stroke-linecap="round"/>
                            </svg>
                        </div>
                    </div>`;
            }).join('');
        }

        function generateSparkline(downward) {
            const pts = [];
            let y = downward ? 5 : 28;
            for (let i = 0; i < 9; i++) {
                const x = (i / 8) * 120;
                y += (downward ? 1 : -1) * (Math.random() * 4 + 1);
                y = Math.max(2, Math.min(30, y));
                pts.push(`${x.toFixed(0)},${y.toFixed(0)}`);
            }
            return pts.join(' ');
        }

        // ==========================================
        // CHEAPEST BEER HERO
        // ==========================================
        function buildCheapestHero() {
            const section = document.getElementById('cheapestHero');
            if (!SPOONS?.pubs?.length) return;

            // Find the absolute cheapest pint across all pubs
            let cheapestPrice = Infinity, cheapestBeer = '', cheapestPub = '', cheapestTown = '';
            for (const pub of SPOONS.pubs) {
                for (const d of (pub.drinks || [])) {
                    if (d.price < cheapestPrice && d.price > 0.5) { // Ignore sub-50p items
                        cheapestPrice = d.price;
                        cheapestBeer = d.name;
                        cheapestPub = pub.name;
                        cheapestTown = pub.town;
                    }
                }
            }

            if (cheapestPrice < Infinity) {
                section.style.display = '';
                document.getElementById('cheapestHeroPrice').textContent = `£${cheapestPrice.toFixed(2)}`;
                document.getElementById('cheapestHeroBeer').textContent = cheapestBeer;
                document.getElementById('cheapestHeroPub').textContent = `${cheapestPub}, ${cheapestTown}`;
                const saving = SPOONS.meta.avgPint - cheapestPrice;
                document.getElementById('cheapestHeroSub').textContent = `£${saving.toFixed(2)} cheaper than the Spoons average`;
            }
        }

        // ==========================================
        // GEOLOCATION — NEAREST CHEAP PINT
        // ==========================================
        let userLat = null, userLon = null;

        function initNearest() {
            if (!SPOONS?.pubs?.length) return;
            const header = document.getElementById('nearestHeader');
            const section = document.getElementById('nearestSection');
            const card = document.getElementById('nearestCard');

            header.style.display = '';
            section.style.display = '';

            // Show enable button initially
            card.innerHTML = `
                <div class="nearest-enable">
                    <button class="nearest-enable-btn" onclick="requestLocation()">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:-2px;margin-right:6px;"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
                        Find my nearest cheap pint
                    </button>
                    <div class="nearest-enable-hint">Uses your location to find nearby Wetherspoons</div>
                </div>`;
        }

        function requestLocation() {
            const card = document.getElementById('nearestCard');
            card.innerHTML = '<div class="nearest-enable"><div class="nearest-enable-hint">Getting your location...</div></div>';

            if (!navigator.geolocation) {
                card.innerHTML = '<div class="nearest-enable"><div class="nearest-enable-hint">Geolocation not available in this browser</div></div>';
                return;
            }

            navigator.geolocation.getCurrentPosition(
                (pos) => {
                    userLat = pos.coords.latitude;
                    userLon = pos.coords.longitude;
                    showNearestPubs();

                    // Also add distance sort to explorer
                    const sortContainer = document.getElementById('explorerSort');
                    if (sortContainer && !document.querySelector('[data-sort="distance"]')) {
                        const btn = document.createElement('button');
                        btn.className = 'explorer-sort-btn';
                        btn.dataset.sort = 'distance';
                        btn.textContent = 'Nearest';
                        btn.addEventListener('click', () => {
                            document.querySelector('.explorer-sort-btn.active').classList.remove('active');
                            btn.classList.add('active');
                            explorerSort = 'distance';
                            explorerVisible = 20;
                            renderExplorer();
                        });
                        sortContainer.prepend(btn);
                    }
                },
                (err) => {
                    card.innerHTML = `<div class="nearest-enable"><div class="nearest-enable-hint">Location access denied. Enable in browser settings.</div></div>`;
                },
                { enableHighAccuracy: false, timeout: 10000 }
            );
        }

        function haversineKm(lat1, lon1, lat2, lon2) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180) * Math.cos(lat2*Math.PI/180) * Math.sin(dLon/2)**2;
            return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        }

        function showNearestPubs() {
            if (!userLat || !SPOONS?.pubs) return;
            const card = document.getElementById('nearestCard');

            // Compute distances
            const withDist = SPOONS.pubs
                .filter(p => p.lat && p.lon)
                .map(p => ({...p, dist: haversineKm(userLat, userLon, p.lat, p.lon)}))
                .sort((a, b) => a.dist - b.dist)
                .slice(0, 5);

            card.innerHTML = `
                <div class="nearest-header">
                    <div class="nearest-title">Nearest to you</div>
                    <div class="nearest-gps"><div class="dot"></div> Live</div>
                </div>
                ${withDist.map((p, i) => {
                    const distStr = p.dist < 1 ? `${(p.dist * 1000).toFixed(0)}m` : `${p.dist.toFixed(1)}km`;
                    return `
                        <div class="nearest-pub">
                            <div class="nearest-pub-rank">${i + 1}</div>
                            <div class="nearest-pub-info">
                                <div class="nearest-pub-name">${p.name}</div>
                                <div class="nearest-pub-detail">${p.town} · ${p.postcode}</div>
                                <div class="nearest-pub-dist">${distStr} away</div>
                            </div>
                            <div class="nearest-pub-price">
                                <div class="price">£${p.min.toFixed(2)}</div>
                                <div class="beer">${p.cheapest || 'cheapest'}</div>
                            </div>
                        </div>`;
                }).join('')}`;
        }

        // ==========================================
        // PRICE DISTRIBUTION HISTOGRAM
        // ==========================================
        function buildDistribution() {
            if (!SPOONS?.pubs?.length) return;

            document.getElementById('distHeader').style.display = '';
            document.getElementById('distSection').style.display = '';

            const prices = SPOONS.pubs.map(p => p.avg).filter(p => p > 0);
            const minP = Math.floor(Math.min(...prices) * 10) / 10;
            const maxP = Math.ceil(Math.max(...prices) * 10) / 10;

            // Create bins (20 bins)
            const numBins = 20;
            const binWidth = (maxP - minP) / numBins;
            const bins = new Array(numBins).fill(0);

            for (const p of prices) {
                const idx = Math.min(Math.floor((p - minP) / binWidth), numBins - 1);
                bins[idx]++;
            }

            const maxBin = Math.max(...bins);
            const barsEl = document.getElementById('distBars');

            const onsAvg = APP_DATA?.national?.current;

            // Position for ONS avg marker line
            const onsPosition = onsAvg ? ((onsAvg - minP) / (maxP - minP) * 100) : null;

            barsEl.innerHTML = bins.map((count, i) => {
                const h = Math.max(2, (count / maxBin) * 100);
                const price = (minP + i * binWidth).toFixed(2);
                const priceEnd = (minP + (i + 1) * binWidth).toFixed(2);

                // Color: green for cheap, amber for mid, red for expensive
                const t = i / (numBins - 1);
                const color = t < 0.4 ? 'var(--green)' : t < 0.7 ? 'var(--amber)' : 'var(--red)';

                return `<div class="distribution-bar" style="height:${h}%;background:${color}" data-tooltip="£${price}–£${priceEnd}: ${count} pubs"></div>`;
            }).join('') + (onsPosition !== null && onsPosition >= 0 && onsPosition <= 100 ?
                `<div style="position:absolute;left:${onsPosition}%;top:0;bottom:0;width:2px;background:var(--red);opacity:0.8;z-index:5;"></div>
                 <div style="position:absolute;left:${onsPosition}%;top:-18px;transform:translateX(-50%);font-size:10px;color:var(--red);font-family:var(--font-mono);white-space:nowrap;z-index:6;">ONS £${onsAvg.toFixed(2)}</div>` : '');
            barsEl.style.position = 'relative';

            document.getElementById('distMin').textContent = `£${minP.toFixed(2)}`;
            document.getElementById('distMax').textContent = `£${maxP.toFixed(2)}`;

            const sorted = [...prices].sort((a,b) => a-b);
            const median = sorted[Math.floor(sorted.length / 2)];
            const onsNote = onsAvg ? ` · ONS national avg: <strong style="color:var(--red)">£${onsAvg.toFixed(2)}</strong>` : '';
            document.getElementById('distMedian').innerHTML = `Median Spoons pint: <strong>£${median.toFixed(2)}</strong>${onsNote}`;
            document.getElementById('distCount').textContent = `${prices.length} pubs`;
        }

        // ==========================================
        // DYNAMIC WATCHLIST FROM SPOONS DATA
        // ==========================================
        function buildDynamicWatchlist() {
            const container = document.querySelector('.watchlist');
            if (!container || !SPOONS?.pubs?.length) return;

            // Pick interesting pubs: cheapest, priciest, and a few random mid-range
            const sorted = [...SPOONS.pubs].sort((a,b) => a.avg - b.avg);
            const picks = [
                sorted[0],                                    // cheapest
                sorted[1],                                    // 2nd cheapest
                sorted[Math.floor(sorted.length / 2)],        // median
                sorted[sorted.length - 2],                     // 2nd priciest
                sorted[sorted.length - 1],                     // priciest
            ].filter(Boolean);

            const icons = [
                { bg: 'var(--green-dim)', stroke: 'var(--green)' },
                { bg: 'var(--green-dim)', stroke: 'var(--green)' },
                { bg: 'var(--amber-dim)', stroke: 'var(--amber)' },
                { bg: 'var(--red-dim)', stroke: 'var(--red)' },
                { bg: 'var(--red-dim)', stroke: 'var(--red)' },
            ];

            container.innerHTML = picks.map((pub, i) => {
                const icon = icons[i];
                const diff = ((pub.avg - SPOONS.meta.avgPint) / SPOONS.meta.avgPint * 100);
                const isUp = diff >= 0;
                const changeClass = Math.abs(diff) < 3 ? 'flat' : (isUp ? 'up' : 'down');
                const sparkPoints = generateSparkline(!isUp);

                return `
                    <div class="watchlist-item fade-up">
                        <div class="watchlist-left">
                            <div class="watchlist-icon" style="background:${icon.bg};">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="${icon.stroke}" stroke-width="2">
                                    <path d="M18 8h1a4 4 0 010 8h-1M2 8h16v9a4 4 0 01-4 4H6a4 4 0 01-4-4V8z"/>
                                    <path d="M6 1v3M10 1v3M14 1v3"/>
                                </svg>
                            </div>
                            <div class="watchlist-info">
                                <div class="watchlist-name">${pub.name}</div>
                                <div class="watchlist-meta">${pub.town} · ${pub.cheapest || 'Wetherspoons'}</div>
                            </div>
                        </div>
                        <div class="watchlist-center">
                            <svg viewBox="0 0 64 32" preserveAspectRatio="none">
                                <polyline points="${sparkPoints}" fill="none" stroke="${isUp ? 'var(--red)' : 'var(--green)'}" stroke-width="1.5" stroke-linecap="round"/>
                            </svg>
                        </div>
                        <div class="watchlist-right">
                            <div class="watchlist-price">£${pub.avg.toFixed(2)}</div>
                            <div class="watchlist-change ${changeClass}">${diff >= 0 ? '+' : ''}${diff.toFixed(1)}%</div>
                        </div>
                    </div>`;
            }).join('');
        }

        // ==========================================
        // DYNAMIC ALERTS FROM REAL DATA
        // ==========================================
        function buildDynamicAlerts() {
            const container = document.querySelector('.alerts');
            if (!container || !SPOONS) return;

            const meta = SPOONS.meta;
            const sorted = [...SPOONS.pubs].sort((a,b) => a.avg - b.avg);
            const cheapest = sorted[0];
            const priciest = sorted[sorted.length - 1];
            const londonPubs = SPOONS.pubs.filter(p => {
                const r = SPOONS.regional?.find(r => r.name === 'London');
                return p.county && ['London','Camden','City of London','Westminster','Southwark','Islington','Lambeth','Wandsworth','Hackney','Tower Hamlets'].some(b => p.county.includes(b));
            });
            const londonAvg = londonPubs.length ? (londonPubs.reduce((s,p) => s + p.avg, 0) / londonPubs.length).toFixed(2) : null;

            const alerts = [
                {
                    icon: 'drop',
                    svg: '<polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/><polyline points="17 18 23 18 23 12"/>',
                    color: 'var(--green)',
                    title: `${cheapest.name} — cheapest in the UK`,
                    desc: `${cheapest.cheapest || 'Cheapest pint'} at £${cheapest.min.toFixed(2)} in ${cheapest.town}. Average pint £${cheapest.avg.toFixed(2)}.`,
                    time: 'Live'
                },
                {
                    icon: 'rise',
                    svg: '<polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/>',
                    color: 'var(--red)',
                    title: `${priciest.name} — priciest Spoons`,
                    desc: `Most expensive pint £${priciest.max.toFixed(2)} in ${priciest.town}. ${((priciest.avg / meta.avgPint - 1) * 100).toFixed(0)}% above national average.`,
                    time: 'Live'
                },
                {
                    icon: 'info',
                    svg: '<circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/>',
                    color: 'var(--blue)',
                    title: `${meta.totalPubs} pubs tracked · £${meta.avgPint.toFixed(2)} avg`,
                    desc: `Prices range from £${meta.cheapestPint.toFixed(2)} to £${meta.mostExpensivePint.toFixed(2)}. ${londonAvg ? `London average: £${londonAvg}.` : ''}`,
                    time: meta.fetchDate
                }
            ];

            container.innerHTML = alerts.map(a => `
                <div class="alert-card fade-up">
                    <div class="alert-icon ${a.icon}">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="${a.color}" stroke-width="2">${a.svg}</svg>
                    </div>
                    <div class="alert-content">
                        <div class="alert-title">${a.title}</div>
                        <div class="alert-desc">${a.desc}</div>
                    </div>
                    <div class="alert-time">${a.time}</div>
                </div>
            `).join('');
        }

        // ==========================================
        // SPOONS EXPLORER
        // ==========================================
        let explorerPubs = [];
        let explorerVisible = 20;
        let explorerSort = 'cheapest';
        let explorerQuery = '';

        function initExplorer() {
            explorerPubs = SPOONS.pubs || [];

            // Stats
            document.getElementById('spoonsTotalPubs').textContent = SPOONS.meta.totalPubs;
            document.getElementById('spoonsAvgPint').textContent = `£${SPOONS.meta.avgPint.toFixed(2)}`;
            document.getElementById('spoonsCheapest').textContent = `£${SPOONS.meta.cheapestPint.toFixed(2)}`;
            document.getElementById('explorerCount').textContent = `${SPOONS.meta.totalPubs} pubs`;
            document.getElementById('spoonsSource').textContent = `Source: Wetherspoons JDW Apps API · ${SPOONS.meta.fetchDate} · ${SPOONS.meta.totalBeers} beers tracked`;

            // Search
            const searchInput = document.getElementById('explorerSearch');
            let debounce;
            searchInput.addEventListener('input', () => {
                clearTimeout(debounce);
                debounce = setTimeout(() => {
                    explorerQuery = searchInput.value.toLowerCase().trim();
                    explorerVisible = 20;
                    renderExplorer();
                }, 200);
            });

            // Sort buttons
            document.querySelectorAll('.explorer-sort-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelector('.explorer-sort-btn.active').classList.remove('active');
                    btn.classList.add('active');
                    explorerSort = btn.dataset.sort;
                    explorerVisible = 20;
                    renderExplorer();
                });
            });

            // Show more
            document.getElementById('explorerMore').addEventListener('click', () => {
                explorerVisible += 20;
                renderExplorer();
            });

            renderExplorer();
        }

        function renderExplorer() {
            let filtered = explorerPubs;

            // Filter by search
            if (explorerQuery) {
                filtered = filtered.filter(p =>
                    p.name.toLowerCase().includes(explorerQuery) ||
                    p.town.toLowerCase().includes(explorerQuery) ||
                    (p.postcode && p.postcode.toLowerCase().includes(explorerQuery)) ||
                    (p.cheapest && p.cheapest.toLowerCase().includes(explorerQuery))
                );
            }

            // Sort
            switch (explorerSort) {
                case 'cheapest':
                    filtered.sort((a, b) => a.avg - b.avg);
                    break;
                case 'expensive':
                    filtered.sort((a, b) => b.avg - a.avg);
                    break;
                case 'name':
                    filtered.sort((a, b) => a.name.localeCompare(b.name));
                    break;
                case 'beers':
                    filtered.sort((a, b) => b.beers - a.beers);
                    break;
                case 'distance':
                    if (userLat && userLon) {
                        filtered = filtered.filter(p => p.lat && p.lon);
                        filtered.forEach(p => { p._dist = haversineKm(userLat, userLon, p.lat, p.lon); });
                        filtered.sort((a, b) => a._dist - b._dist);
                    }
                    break;
            }

            const visible = filtered.slice(0, explorerVisible);
            const list = document.getElementById('explorerList');

            list.innerHTML = visible.map((pub, i) => {
                const priceColor = pub.avg <= SPOONS.meta.avgPint * 0.85 ? 'var(--green)' :
                                   pub.avg >= SPOONS.meta.avgPint * 1.15 ? 'var(--red)' : 'var(--text-primary)';
                const rank = (explorerSort === 'cheapest' || explorerSort === 'expensive' || explorerSort === 'distance') ? i + 1 : null;
                const distStr = pub._dist != null ? (pub._dist < 1 ? `${(pub._dist*1000).toFixed(0)}m` : `${pub._dist.toFixed(1)}km`) : null;
                const onsAvg = APP_DATA?.national?.current;
                const vsOns = onsAvg ? ((1 - pub.avg / onsAvg) * 100).toFixed(0) : null;

                return `
                    <div class="explorer-pub" onclick="togglePubDetail(this)">
                        <div class="explorer-pub-left">
                            ${rank ? `<div class="explorer-pub-rank">#${rank}</div>` : ''}
                            <div class="explorer-pub-name">${pub.name}</div>
                            <div class="explorer-pub-location">${pub.town}${pub.postcode ? ' · ' + pub.postcode : ''}${distStr ? ' · <span style="color:var(--green)">' + distStr + '</span>' : ''}</div>
                        </div>
                        <div class="explorer-pub-right">
                            <div class="explorer-pub-price" style="color:${priceColor}">£${pub.avg.toFixed(2)}</div>
                            <div class="explorer-pub-range">£${pub.min.toFixed(2)} – £${pub.max.toFixed(2)}</div>
                            ${vsOns ? `<div class="explorer-pub-cheapest" style="color:${parseInt(vsOns) > 0 ? 'var(--green)' : 'var(--red)'}">${parseInt(vsOns) > 0 ? '▼' : '▲'} ${Math.abs(vsOns)}% vs ONS</div>` : (pub.cheapest ? `<div class="explorer-pub-cheapest">${pub.cheapest}</div>` : '')}
                        </div>
                    </div>
                    <div class="explorer-pub-detail">
                        <div class="explorer-drink-row" style="border-bottom:1px solid var(--border);padding-bottom:6px;margin-bottom:4px;">
                            <div class="explorer-drink-name" style="color:var(--text-secondary);font-size:11px;">${pub.beers} beers · cheapest: ${pub.cheapest || '—'}</div>
                            ${onsAvg ? `<div class="explorer-drink-price" style="color:var(--green);font-size:11px;">Save £${(onsAvg - pub.avg).toFixed(2)}/pint vs national</div>` : ''}
                        </div>
                        ${(pub.drinks || []).map(d => `
                            <div class="explorer-drink-row">
                                <div class="explorer-drink-name">${d.name}</div>
                                ${d.abv ? `<div class="explorer-drink-abv">${d.abv}%</div>` : ''}
                                <div class="explorer-drink-price">£${d.price.toFixed(2)}</div>
                            </div>
                        `).join('')}
                    </div>`;
            }).join('');

            // Show more button
            const moreBtn = document.getElementById('explorerMore');
            if (filtered.length > explorerVisible) {
                moreBtn.style.display = 'block';
                moreBtn.textContent = `Show more (${explorerVisible}/${filtered.length})`;
            } else {
                moreBtn.style.display = 'none';
            }

            // Update count
            if (explorerQuery) {
                document.getElementById('explorerCount').textContent = `${filtered.length} found`;
            }
        }

        function togglePubDetail(el) {
            const wasExpanded = el.classList.contains('expanded');
            // Close all
            document.querySelectorAll('.explorer-pub.expanded').forEach(p => p.classList.remove('expanded'));
            // Toggle this one
            if (!wasExpanded) el.classList.add('expanded');
        }

        // ==========================================
        // PINT CALCULATOR
        // ==========================================
        (function initPintCalc() {
            const input = document.getElementById('pintCalcInput');
            if (!input) return;

            function updateCalc() {
                const price = parseFloat(input.value) || 4.83;
                // Proportions based on BBPA data for a £4.83 pint
                const govtPct = 0.3334;   // 33.34% (duty + VAT + rates)
                const breweryPct = 0.2174; // 21.74%
                const rentPct = 0.2402;    // 24.02%
                const staffPct = 0.1780;   // 17.80%
                const profitPct = 0.0248;  // 2.48% (~12p on £4.83)

                const govt = price * govtPct;
                const brewery = price * breweryPct;
                const rent = price * rentPct;
                const staff = price * staffPct;
                const profit = price * profitPct;
                const ratio = Math.round(govt / profit);

                document.getElementById('calcGovt').textContent = `£${govt.toFixed(2)}`;
                document.getElementById('calcBrewery').textContent = `£${brewery.toFixed(2)}`;
                document.getElementById('calcRent').textContent = `£${rent.toFixed(2)}`;
                document.getElementById('calcStaff').textContent = `£${staff.toFixed(2)}`;
                document.getElementById('calcProfit').textContent = `£${profit.toFixed(2)}`;
                document.getElementById('calcRatio').textContent = `${ratio}:1`;

                // Pints needed for minimum wage (£12.21/hr × 60hrs/week = £732.60/week)
                const weeklyWage = 12.21 * 60;
                const pintsPerWeek = Math.ceil(weeklyWage / profit);
                const pintsPerDay = Math.ceil(pintsPerWeek / 7);
                const profitPence = Math.round(profit * 100);
                document.getElementById('calcPintsNeeded').innerHTML = profitPence > 0
                    ? `At ${profitPence}p profit per pint, your publican needs to sell <strong>${pintsPerDay.toLocaleString()} pints per day</strong> to earn minimum wage (£12.21/hr, 60hr weeks).`
                    : `At this price, the publican makes <strong>nothing</strong>.`;

                // Update the receipt too
                // Tax breakdown: duty ~7.2%, VAT ~16.7% (VAT = price/6), rates ~9.3%
                const vat = price / 6;           // VAT at 20% = price/6
                const duty = price * 0.0725;     // beer duty ~7.25%
                const rates = govt - vat - duty;  // remainder of govt take = rates
                const rcptStaff = staff + profit; // receipt lumps profit separately

                const s = (v) => `£${v.toFixed(2)}`;
                const el = (id) => document.getElementById(id);
                if (el('rcptTotal'))     el('rcptTotal').textContent = s(price);
                if (el('rcptDuty'))      el('rcptDuty').textContent = s(duty);
                if (el('rcptVat'))       el('rcptVat').textContent = s(vat);
                if (el('rcptRates'))     el('rcptRates').textContent = s(Math.max(0, rates));
                if (el('rcptBrewery'))   el('rcptBrewery').textContent = s(brewery);
                if (el('rcptRent'))      el('rcptRent').textContent = s(rent);
                if (el('rcptStaff'))     el('rcptStaff').textContent = s(staff);
                if (el('rcptGovtTotal')) el('rcptGovtTotal').textContent = s(govt);
                if (el('rcptProfit'))    el('rcptProfit').textContent = s(profit);
                if (el('rcptRatio'))     el('rcptRatio').textContent = `${ratio}x more.`;
            }

            input.addEventListener('input', updateCalc);
            updateCalc();
        })();

        // ==========================================
        // LIVE GOVERNMENT REVENUE COUNTER
        // ==========================================
        (function initLiveCounter() {
            const counter = document.getElementById('liveCounter');
            const valueEl = document.getElementById('liveCounterValue');
            const stmtZone = document.querySelector('.statement-zone');
            if (!counter || !valueEl || !stmtZone) return;

            // UK sells ~7.2B pints/year. Govt takes ~£1.61/pint.
            // = £11.592B/year = £367.56/second
            const perSecond = 367.56;
            const pageLoadTime = Date.now();
            let animFrame;

            function updateCounter() {
                const elapsed = (Date.now() - pageLoadTime) / 1000;
                const total = elapsed * perSecond;
                if (total < 1000) {
                    valueEl.textContent = `£${Math.floor(total).toLocaleString()}`;
                } else if (total < 1000000) {
                    valueEl.textContent = `£${(total / 1000).toFixed(1)}k`;
                } else {
                    valueEl.textContent = `£${(total / 1000000).toFixed(2)}m`;
                }
                animFrame = requestAnimationFrame(updateCounter);
            }

            // Show/hide based on statement zone visibility
            const obs = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        counter.classList.add('visible');
                        if (!animFrame) updateCounter();
                    } else {
                        counter.classList.remove('visible');
                        if (animFrame) { cancelAnimationFrame(animFrame); animFrame = null; }
                    }
                });
            }, { threshold: 0.05 });
            obs.observe(stmtZone);
        })();

        // ==========================================
        // SHARING
        // ==========================================
        const SHARE_URL = 'https://projects.maxyouell.co.uk/pint-of-no-return/';
        const SHARE_TEXT = 'The government takes £1.61 from every pint. The publican keeps 12p. That\'s 13x more.\n\n15,800 pubs lost since 2000. One closing every day.\n\n';

        async function shareReceipt() {
            const receipt = document.querySelector('.receipt');
            if (!receipt || typeof html2canvas === 'undefined') return;

            const btn = event.currentTarget;
            const origText = btn.innerHTML;
            btn.innerHTML = '<span>Saving...</span>';

            try {
                const canvas = await html2canvas(receipt, {
                    backgroundColor: '#f5f0e8',
                    scale: 3,
                    useCORS: true,
                    logging: false
                });

                // Try Web Share API first (mobile)
                if (navigator.share && navigator.canShare) {
                    canvas.toBlob(async (blob) => {
                        const file = new File([blob], 'pint-receipt.png', { type: 'image/png' });
                        const shareData = {
                            title: 'Pint of No Return — The Receipt',
                            text: SHARE_TEXT,
                            url: SHARE_URL,
                            files: [file]
                        };
                        if (navigator.canShare(shareData)) {
                            try {
                                await navigator.share(shareData);
                                btn.innerHTML = origText;
                                return;
                            } catch (e) { /* user cancelled or error, fall through to download */ }
                        }
                        downloadCanvas(canvas);
                        btn.innerHTML = origText;
                    }, 'image/png');
                } else {
                    downloadCanvas(canvas);
                    btn.innerHTML = origText;
                }
            } catch (e) {
                console.error('Receipt capture failed:', e);
                btn.innerHTML = origText;
            }
        }

        function downloadCanvas(canvas) {
            const link = document.createElement('a');
            link.download = 'pint-of-no-return-receipt.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        }

        function shareToX() {
            const text = encodeURIComponent(SHARE_TEXT + SHARE_URL);
            window.open(`https://x.com/intent/tweet?text=${text}`, '_blank', 'width=550,height=420');
        }

        function shareToFacebook() {
            const url = encodeURIComponent(SHARE_URL);
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank', 'width=550,height=420');
        }

        function copyLink() {
            navigator.clipboard.writeText(SHARE_URL).then(() => {
                const btn = event.currentTarget;
                btn.classList.add('copied');
                setTimeout(() => btn.classList.remove('copied'), 2000);
            });
        }
    </script>

</body>
</html>
